\documentclass[10pt,a4paper,oneside,reqno]{amsart}

\usepackage{amsmath,geometry,amssymb,mathpartir,mathtools,latexsym,amsthm,enumerate,leftidx,tikz}
\usepackage[all]{xy}
\newcommand{\xycenter}[1]{\vcenter{\hbox{\xymatrix{#1}}}}
\SelectTips{cm}{}
\input{prooftree}

% Numberings 
\setcounter{tocdepth}{2}
\numberwithin{equation}{section}

% Table of contents
\makeatletter
\def\@tocline#1#2#3#4#5#6#7{\relax
\ifnum #1>\c@tocdepth % then omit
  \else 
    \par \addpenalty\@secpenalty\addvspace{#2}% 
\begingroup \hyphenpenalty\@M
    \@ifempty{#4}{%
      \@tempdima\csname r@tocindent\number#1\endcsname\relax
 }{%
   \@tempdima#4\relax
 }%
 \parindent\z@ \leftskip#3\relax \advance\leftskip\@tempdima\relax
 \rightskip\@pnumwidth plus4em \parfillskip-\@pnumwidth
 #5\leavevmode\hskip-\@tempdima #6\nobreak\relax
 \ifnum#1<0\hfill\else\dotfill\fi\hbox to\@pnumwidth{\@tocpagenum{#7}}\par
 \nobreak
 \endgroup
  \fi}
\makeatother

% Theorems

\newtheoremstyle{mythm}% 
{10pt}% Space above 
{}% Space below 
{\itshape}% Body font 
{}% Indent amount 
{\bfseries}%  Theorem head font 
{.}% Punctuation after theorem head 
{.5em}% Space after theorem head 
{}% 

\newtheoremstyle{mydef}% 
{10pt}% Space above 
{3pt}% Space below 
{}% Body font 
{}% Indent amount 
{\bfseries}%  Theorem head font 
{.}% Punctuation after theorem head 
{.5em}% Space after theorem head 
{}% 

\newtheoremstyle{myrmk}% 
{10pt}% Space above 
{3pt}% Space below 
{}% Body font 
{}% Indent amount 
{\itshape}%  Theorem head font 
{.}% Punctuation after theorem head 
{.5em}% Space after theorem head 
{}% 

\theoremstyle{mythm}
\newtheorem{theorem}{Theorem}[section]
\newtheorem*{theorem*}{Theorem}
\newtheorem{lemma}[theorem]{Lemma} 
\newtheorem{proposition}[theorem]{Proposition} 
\newtheorem{corollary}[theorem]{Corollary}  
\newtheorem{apptheorem}{Theorem}
\newtheorem{atheorem}{Theorem}
\renewcommand*{\theatheorem}{\Alph{atheorem}}
\theoremstyle{mydef}
\newtheorem{definition}[theorem]{Definition}	
\newtheorem*{definition*}{Definition}	
\theoremstyle{myrmk}
\newtheorem{remark}[theorem]{Remark} 
\newtheorem{remarks}[theorem]{Remarks} 
\newtheorem*{remark*}{Remark} 
\newtheorem*{remarks*}{Remarks} 
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}
\newtheorem*{example*}{Example}
\newtheorem*{examples*}{Examples}

% Text commands
\newcommand{\ie}{\text{i.e.\ }}
\newcommand{\eg}{\text{e.g.}}
\newcommand{\resp}{\text{resp.\ }}
\newcommand{\myemph}[1]{\textit{#1}}
\newcommand{\by}[1]{\quad&&\text{by {$#1$}}}

% Judgemental equality, path equality, homotopy, definitions
\newcommand{\deq}{=}
\newcommand{\peq}{\Rightarrow}
\newcommand{\ho}{\sim}
\newcommand{\defeq}{=_{\mathrm{def}}}
\newcommand{\co}{\colon}
\newcommand{\type}{\mathsf{type}}

% Composition and identiies
\newcommand{\idfun}[1]{\mathsf{id}_{#1}}
\newcommand{\comp}{\circ}
\newcommand{\ct}{\cdot}

% Names for type theories
\newcommand{\Hint}{\mathrm{H}}
\newcommand{\Hext}{\mathrm{H}_{\mathrm{ext}}}
\newcommand{\UA}{\mathrm{UA}}

% General notions

\newcommand{\hfiber}{\mathsf{hfiber}}
\newcommand{\iscontr}{\mathsf{iscontr}}
\newcommand{\isntype}[1]{\mathsf{is}\text{-}\mathsf{#1}\text{-}\mathsf{type}}
\newcommand{\isprop}{\mathsf{isprop}}
\newcommand{\isequiv}{\mathsf{isequiv}}
\newcommand{\isind}{\mathsf{isind}}
\newcommand{\ishinit}{\mathsf{ishinit}}
\newcommand{\trans}{\mathsf{tr}}
\newcommand{\Hot}{\mathsf{Hot}}

% Extensionality

\newcommand{\ext}{\mathsf{ext}}
\renewcommand{\int}{\mathsf{int}}
\newcommand{\idtodpair}{\ext_\Sigma}
\newcommand{\happly}{\ext_\Pi}
\newcommand{\funext}{\int_\Pi}       
\newcommand{\idtoeq}{\ext_\Id}

% Bool

\newcommand{\Bool}{\mathsf{Bool}}
\newcommand{\true}{1}
\newcommand{\false}{0}
\newcommand{\one}{\mathsf{1}}
\newcommand{\zero}{\mathsf{0}}
\newcommand{\boolind}{\mathsf{ind}}
\newcommand{\boolrec}{\mathsf{rec}}

% Nat

\newcommand{\nat}{\ensuremath{\mathbb{N}}} 
\newcommand{\suc}{\mathsf{suc}}

% Id-types

\newcommand{\Id}{\mathsf{Path}}
\newcommand{\id}[1]{\Id_{#1}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\idrec}{\mathsf{J}}

% Pi-types

\newcommand{\prd}[1]{\Pi_{#1}}
\newcommand{\lam}[1]{\lambda_{#1}}   
\newcommand{\app}{\mathsf{ap}}

% Sigma-types

\newcommand{\sm}[1]{\Sigma_{#1}}    
\newcommand{\pair}{\mathsf{pair}}
\newcommand{\mysplit}{\mathsf{split}}
\newcommand{\fst}{\mathsf{fst}}
\newcommand{\snd}{\mathsf{snd}}

% W-types

\newcommand{\W}{\mathsf{W}}
\DeclareMathOperator*{\WW}{\text{\Large $\mathrm{W}$}}
\newcommand{\wsup}{\mathsf{sup}}
\newcommand{\wrec}{\mathsf{wrec}}
\newcommand{\wind}{\mathsf{wind}}
\newcommand{\wcomp}{\mathsf{wcomp}}

% Universes

\newcommand{\U}{\mathsf{U}}

% Bipointed types

\newcommand{\ind}{\mathsf{ind}}
\newcommand{\rec}{\mathsf{rec}}
\newcommand{\Hom}{\mathsf{Hom}}
\newcommand{\Ho}{\mathsf{Ho}}
\newcommand{\Bip}{\mathsf{Bip}}
\newcommand{\BipHom}{\mathsf{Bip}}
\newcommand{\BipHot}{\mathsf{BipHot}}
\newcommand{\FibBip}{\mathsf{FibBip}}
\newcommand{\BipSec}{\mathsf{BipSec}}
\newcommand{\isbipequiv}{\mathsf{isbipequiv}}
\newcommand{\BipEquiv}{\mathsf{BipEquiv}}
\newcommand{\HoSec}{\mathsf{BipSecHo}}

% P-algebras

\newcommand{\Palg}{P\text{-}\mathsf{Alg}}
\renewcommand{\sup}{\mathrm{sup}}
\newcommand{\AlgHot}{\mathsf{AlgHot}}
\newcommand{\FibAlgHot}{\mathsf{FibAlgHot}}
\newcommand{\FibPalg}{P\text{-}\mathsf{FibAlg}}
\newcommand{\PalgSec}{\mathsf{AlgSec}}


% DOCUMENT 

\begin{document}

\title{Homotopy-initial algebras in type theory}
\author[S. Awodey]{STEVE AWODEY}
\address{Steve Awodey, Department of Philosophy 
Carnegie Mellon University 
Pittsburgh, PA  15213, USA}
\email{awodey@cmu.edu}
\author[N. Gambino]{NICOLA GAMBINO}
\address{Nicola Gambino, School of Mathematics, University of Leeds, Leeds LS2 9JT, UK}
\email{n.gambino@leeds.ac.uk}
\author[K. Sojakova]{KRISTINA SOJAKOVA}
\address{Kristina Sojakova, Department of Computer Science, Carnegie Mellon University, Pittsburgh, PA 15213, USA}
\email{kristinas@cmu.edu}
\date{\today}



\begin{abstract}
Homotopy type theory is an interpretation of Martin-L\"of's constructive type theory into abstract homotopy theory.   There results a link between constructive mathematics and algebraic topology, providing topological semantics for intensional systems of type theory as well as a computational approach to algebraic topology via type theory-based proof assistants such as~Coq.

The present work investigates inductive types in this setting. Modified rules for inductive types, including types of well-founded trees, or W-types, are presented, and the basic homotopical semantics of such types are determined.  Proofs of all results have been formally verified by the Coq proof assistant, and the proof scripts for this verification form an essential component of this research.      
\end{abstract}


\maketitle



\begin{small}
\tableofcontents
\end{small}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}

The general topic of Homotopy Type Theory is concerned with the study of the constructive type theories of Martin-L\"of under their new interpretation into abstract homotopy theory and higher-dimensional category theory. Martin-L\"of type theories are foundational systems which have been used to formalize large parts of constructive mathematics, and also for the development of high-level programming languages~\cite{MartinLofP:conmcp}.  They are prized for their combination of expressive strength and desirable proof-theoretic properties.  One aspect of these type theories that has led to special difficulties in providing semantics is the intensional character of equality.  In recent work \cite{AwodeyS:homtmi,VoevodskyV:notts,vandenBergB:topsmi,AwodeyS:typth}, it has emerged that the topological notion of \emph{homotopy} provides an adequate basis for the semantics of intensionality.  This extends the paradigm of computability as continuity, familiar from domain theory, beyond the simply-typed 
$\lambda$-calculus to dependently-typed theories involving:\begin{enumerate}[(i)]
\item dependent sums $(\Sigma x\colon\!{A})B(x)$ and dependent products $(\Pi x\colon\!{A})B(x)$, modelled respectively by the total space and the space of sections of the fibration modelling the dependency of $B(x)$ over $ x : A$; \item
and, crucially, including the identity type constructor~$\id{A}(a,b)$, interpreted as the space of all \emph{paths} in~$A$ between points~$a$ and~$b$. \end{enumerate}

In the present work, we build on this homotopical interpretation to study inductive types, such as the natural numbers, Booleans, lists, and W-types. Within extensional type theories, W-types can be used to  provide a constructive counterpart of the classical notion of a well-ordering~\cite{MartinLofP:inttt} and to uniformly define a variety of inductive types~\cite{DybjerP:repids}.
However, most programming languages and proof assistants, such as Coq~\cite{BertotY:inttpp}, Agda~\cite{NorellU:towppl} and Epigram~\cite{McBrideC:viefl} use schematic inductive definitions~\cite{CoquandT:inddt,PaulinMorhringC:inddsc} rather than W-types to define inductive types.  This is due in part to the practical convenience of the schematic approach, but it is also a matter of necessity; these systems are based on intensional rather than extensional type theories, and in the intensional theory the usual reductions of inductive types to W-types fail~\cite{DybjerP:repids,McBrideC:wtygnb}.
Nonetheless, W-types retain great importance from a theoretical perspective, since they allow us to internalize in type theory arguments about inductive types. Furthermore, as we will see in Section~\ref{section:intW}, a limited form of extensionality licensed by the homotopical interpretation suffices to develop the theory of W-types in a satisfactory way. In particular, we shall make use of ideas from higher category theory and homotopy theory to understand W-types as ``homotopy-initial" algebras of an appropriate kind.

In intensional type theories, inductive types cannot be characterized by standard category-theoretic
universal properties. For instance, in this setting it is not possible to show that there exists a 
definitionally-unique function out of the empty type with rules as in~\cite[Section~5.2]{NordstromB:marltt}, thus making it impossible to prove that the empty type provides an initial object. 
Another consequence of this fact is that, if we attempt to define the type of 
natural numbers as a W-type in the usual way, then 
the usual elimination and computation rules for it are no longer derivable~\cite{DybjerP:repids}. Similarly, it is not possible to show the uniqueness of recursively-defined functions out of W-types. When interpreted categorically, the uniqueness of such functions translates into the initiality property of the associated polynomial functor algebra, which is why the correspondence between W-types and initial algebras fails in the intensional setting.

Due to this sort of poor behaviour of W-types, and other constructions, in the purely intensional setting, that system is often augmented by other extensionality principles that are somewhat weaker than the Reflection rule, such as Streicher's K-rule  or the Uniqueness of Identity Proofs (UIP)~\cite{StreicherT:invitt}, which has recently been reconsidered
in the context of Observational Type Theory \cite{AltenkirchT:obsen}.  Inductive types in such intermediate systems are somewhat better behaved, but still exhibit some undesirable properties, making them less useful for practical purposes than one might wish~\cite{McBrideC:wtygnb}.  Moreover, these intermediate systems seem to lack a clear conceptual basis:  they neither intend to formalize constructive sets (like the extensional theory) nor is there a principled reason to choose these particular extensionality rules, beyond their practical advantages.  



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Preliminaries}
\label{section:prelim}



We work here with type theories that have the four standard forms of judgement
\[
A \co \type \, , \quad A \deq B \co \type \, , \quad   a \co A \, , \quad a \deq b \co A \, . 
\]
We refer to the equality relation in these judgements as judgemental equality, 
which should be contrasted with the notion of propositional equality
recalled below. 
Such a judgement  can be made also relative to a context of variable declarations.
However, when stating deduction
rules we  omit the mention
of a context that is common to premisses and conclusions of the rule and
make use of other standard conventions to simplify the exposition.

We will work over a dependent type theory $\Hint$ which has standard structural rules, rules for $\Pi$-types as in Table~\ref{tab:pi}, rules for $\Sigma$-types as in Table~\ref{tab:sigma}, rules for identity types as in Table~\ref{tab:id}, and the Function Extensionality axiom, \ie the axiom asserting that
for every $f, g : A \rightarrow B$, the type
\[
(\Pi x :  A)\id{B}( \app(f, x), \app(g, x)) \rightarrow \id{A \rightarrow B}(f,g) 
\]
is inhabited. Here, we have used the notation $A \rightarrow B$ to indicate function types, defined via
$\Pi$-types in the usual way. Similarly, we will write $A \times B$ to denote the binary product
of two types as usually defined via $\Sigma$-types. We say that two elements  $a, b :A$ are propositionally equal if 
 the type $\Id(a,b)$ is inhabited.






\begin{remarks*} \hfill 
\begin{enumerate}[(i)]
\item The rules for $\Pi$-types of $\Hint$ are derivable from those
in~\cite[Section~5.4]{NordstromB:marltt}. For simplicity, 
we will write~$f(a)$ or~$f  a$ instead of $\app(f,a)$. 
\item As shown in~\cite{VoevodskyV:unifc}, the principle of propositional function extensionality stated above implies
the corresponding principle for dependent functions, \emph{i.e.} 
\[
(\Pi x :  A)\id{B(x)}( f x, g x) \rightarrow \id{(\Pi x : A) B(x)}(f,g) \, .
\]
\item The following form of the $\eta$-rule for $\Sigma$-types is derivable:
\[
\begin{prooftree}
c  : (\Sigma x : A)B(x) 
\justifies
\eta_{\Sigma}(c) : \Id(c, \pair( \pi_1 c \, , \pi_2 c)) \, , 
\end{prooftree}
\]
 where $\pi_1$ and $\pi_2$ are the projections. This  can be proved by $\Sigma$-elimination,
without FE.
\item $\Hint$ does \emph{not} include the $\eta$-rules as definitional equalities for $\Sigma$-types as is done in~\cite{GoguenH:inddtw}.
\item The type theory $\Hint$ will serve as the background theory for our study of 
inductive types and W-types. For this reason, we need not assume it to have any primitive types.
\end{enumerate}
\end{remarks*}


\noindent
This particular combination of rules is motivated by the fact that $\Hint$ has a clear
homotopy-theoretic sematics. Indeed, the type theory~$\Hint$ is a subsystem of the type theory 
used in Voevodsky's Univalent Foundations library~\cite{VoevodskyV:unifc}.  In particular, the 
Function Extensionality axiom is formally implied by Voevodsky's Univalence axiom~\cite{VoevodskyV:notts}, 
which is also valid in homotopy-theoretic models, but will not be needed here. Note that, 
while the Function Extensionality axiom is valid also in set-theoretic models, the Univalence 
axiom is not. Although $\Hint$ has a straightforward set-theoretical semantics, we stress that it 
does not have any global extensionality rules, like the identity reflection rule, K, or UIP. This makes it also compatible with ``higher-dimensional" interpretations such as the groupoid model~\cite{HofmannM:gromtt}, in which the rules of $\Hint$ are also valid.

\begin{remark}[Extensional type theories] 
Most work on inductive to date (\eg~\cite{AbbottM:concsp,DybjerP:repids,GambinoN:weltdp,MoerdijkI:weltc}) has been in the setting of extensional type theories,  
in which the following rule, known as the identity reflection rule, is also assumed:
\begin{equation}
\label{equ:collapse}
\begin{prooftree}
 p :  \id{A}(a,b)
  \justifies
  a=b :  A
\end{prooftree}
\end{equation}
This rule collapses propositional equality with definitional equality, thus making the overall system
somewhat simpler to work with. However, it destroys the constructive character of the intensional system, since it makes type-checking undecidable~\cite{HofmannM:extcit}. For this reason, it is not assumed
in the most recent formulations of Martin-L\"of type theories~\cite{NordstromB:marltt} or in automated proof assistants like Coq~\cite{BertotY:inttpp}.

\end{remark}


\bigskip

The main import of the 
$\Id$-elimination rule is that  type dependency must respect identity, in the following sense: given a dependent type
\begin{equation}
\label{equ:deptype}
x:A \vdash B(x) : \type \, ,
\end{equation} 
and $p: \id{A}(a,b)$, there is then a \emph{transport} function 
 $$p_{\, ! } : B(a) \rightarrow B(b),$$ which is defined by $\Id$-elimination, taking for $x : A$
the function $\refl(x)_{\, !} : B(x) \rightarrow B(x)$ to be the identity on $B(x)$.  
 The topological notion of contractibility admits the following type-theoretic counterpart, originally
 introduced by Voevodsky in~\cite{VoevodskyV:unifc}.


\begin{definition}  A type $A$ is said to be \emph{contractible} if the  type 
 \begin{equation}
 \label{eq:contractible}
\iscontr(A) \defeq (\Sigma x:A)(\Pi y:A)\id{A}(x,y)
\end{equation}
is inhabited.
\end{definition} 

The type $\iscontr(A)$ can be seen as the propositions-as-types translation
of the formula stating that $A$ has a unique element. However, its homotopical interpretation 
is as a space that is inhabited if and only if the space interpreting $A$ is contractible in the usual
topological sense. Note that if $A$ is a contractible type, then for every $a, b : A$, the type $\id{A}(a,b)$ is again contractible. 
This can be proved  by $\Id$-elimination. The notion of contractibility can be used to articulate the world of types  into \emph{h-levels} according to their
homotopical complexity~\cite{VoevodskyV:unifc}. We will need to recall only the notion of type of $h$-level 0, or h-proposition.

\begin{definition} A type $A$ is said to be a \emph{h-proposition} if the type
\[
\isprop(A) \defeq (\Pi x : A)(\Pi y : A) \iscontr( \Id(x,y)) 
\]
is inhabilted.
\end{definition}


Let us also recall from~\cite{VoevodskyV:unifc} the notions of weak equivalence and homotopy equivalence. To do this, we need to fix some notation. For $f : A \rightarrow B$ and $y : B$, define the he \emph{homotopy fiber} of $f$ at $y$ as the type
\[
 \hfiber(f,y) \defeq (\Sigma x : A) \id{B}(f x, y) \, .
\]
Recall that a function $f$ is an equivalence if an only if every fiber is contractible, \ie the type
\[
 (\Pi y : B) \,  \iscontr(\hfiber(f,y)) 
\]
is inhabited. 


\begin{definition} \label{thm:weq}  We say that $f : A \rightarrow B$ is a weak equivalence if it has both a left inverse and a right inverse, \ie
$\ell \co B \to A$ and $r \co B \to A$ such that 
\[
 \ell \circ f = 1_A \, ,  \quad  f \circ r = 1_B  \, .
 \]
 \end{definition}
 
 Accordingly, for $f : A \rightarrow B$, we define the type of proofs that $f$ is an equivalence by letting
 \[ 
 \isequiv(f) \defeq (\Sigma \ell \co B \to A) \Id( \ell \circ f, 1_A) \times (\Sigma r \co B \to A) \Id( r \circ f , 1_B) \, .
 \]





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Bipointed types}
\label{sec:bip}



Let $A \in \U$ be a small type and suppose that there is an equivalence $f \co \Bool \to A$. Then, the type $A$ 
has two distinguished elements $a_0 \defeq f(0)$ and $a_1 \defeq f(1)$, and it satisfies
analogues of the elimination and computation rules for $\Bool$, except that the conclusions of the computation 
rules need to be modified  by replacing the judgemental equalities  with propositional ones. Our aim in this section is to provide a characterisation of the types equivalent to $\Bool$ by means of a type-theoretical universal property. In order to do so, we introduce the notion of a bipointed type. 


\begin{definition} \label{thm:bipointedtype}
A  (small) \emph{bipointed type} consists of a small type $A \in \U$ together with two distingished elements 
$a_0 \in A$, $a_1 \in A$.
\end{definition}

The type of small bipointed types is then defined by letting $\Bip \defeq \sum_ {A \in \U}( A \times A )$. 
Note that this type is not small.
When referring to a bipointed type we sometimes suppress mention of its distinguished elements and write $A = (A, a_0, a_1)$ to
recall this abuse of language.  In the following, it will be convenient to represent a bipointed type $A$ diagrammatically as follows:
\[
\xymatrix{
 1 \ar[r]^-{a_0}&  A & 1 \ar[l]_-{a_1} \, .}
 \]
The type $\Bool$ and its canonical elements $0, 1 \in \Bool$ give us a bipointed type:
\[
\xymatrix{
 1 \ar[r]^-{0}&  \Bool  & 1 \ar[l]_-{1} \, . }
 \]
We now introduce the notion of a bipointed morphism.

\begin{definition} For bipointed types $A = (A, a_0, a_1)$ and $B = (B, b_0, b_1)$, a \emph{bipointed morphism} 
\[
(f, \bar{f}_0, \bar{f}_1)  \co (A, a_0, a_1)  \to (B, b_0, b_1)
\] 
consists of a function $f \co A \to B$ together with paths $\bar{f}_0 \co  f(a_0) \Rightarrow b_0$ 
and~$\bar{f}_1 \co f(a_1) \Rightarrow b_1$.  \end{definition}


The type of bipointed morphisms from $A$ to $B$ is then defined by letting
\[
\BipHom(A,B) \defeq \sum_{ f \co A \to B} \Id(  f(a_0), b_0 )  \times \Id(  f(a_1), b_1 ) \, .
\]
We will often refer to a bipointed morphism by mentioning only its underlying function, leaving implicit
the rest of the data. Diagrammatically, we represent a bipointed morphism as follows:
\[
\xymatrix{
1 \ar[r]   \ar[r]^{a_0} \ar@/_1pc/[dr]_{b_0}  & A  \ar[d]^{f} & 1  \ar[l]_{a_1} \ar@/^1pc/[dl]^{b_1} \\
  & B  &  }
 \]
Bipointed types and their morphisms behave much like objects and morphisms in a category.
Given two bipointed morphisms  $(f, \bar{f}_0, \bar{f}_1) \co A \to B$ and $(g, \bar{g}_0, \bar{g}_1) \co B \to C$, we can define their composite 
 as the triple consisting of the composite $g \circ f \co A \to C$ and the paths represented
by the following pasting diagram:
\[
\xymatrix@C=1.5cm{
1 \ar[r]   \ar[r]^{a_0}   \ar@/_1pc/[dr]^{b_0} \ar@/_1pc/[ddr]_{c_0}  & A  \ar[d]^{f} & 1 \ar[l]_{a_1}  \ar@/^1pc/[dl]_{b_1}  \ar@/^1pc/[ddl]^{c_1} \\
  & B \ar[d]^g &   \\
  & C \, . &   }
  \]
Explicitly,
\[
\overline{(g \circ f)}_0 \defeq g(\bar{f}_0) \cdot  \bar{g}_0 \, ,   \quad 
\overline{(g \circ f) }_1 \defeq  g(\bar{f}_1) \cdot   \bar{g}_1 \, .
\]
Also, for any bipointed type $A = (A, a_0, a_1)$, the identity function $1_A \co A \to A$ can be equipped with the structure of a 
bipointed morphism in an evident way. 
We do not quite have a category, however, since the composition operation is not strictly associative, but only associative up to a system of higher and higher 
homotopies, as in an $(\infty,1)$-category.  

\medskip

We now discuss the notion of equivalence between bipointed types.



\begin{definition} We say that a bipointed morphism $f \co A \to B$ is a \myemph{bipointed equivalence}
if there exist bipointed morphisms $\ell \co B \to A$ and $r \co B \to A$ which provide a left and a right bipointed inverse for $f$, \ie such that there exist paths $p \co \ell \circ f \Rightarrow 1_A$ in $\Bip(A,A)$ and $q \co f \circ r \Rightarrow 1_B$
in $\Bip(B,B)$.
\end{definition}

For a bipointed morphism $f \co A \to B$, the type of proofs that $f$ is a bipointed equivalence is
then defined by letting
\[
\isbipequiv(f) \defeq   \sum_{\ell \in \BipHom(B,A)} \Id( \ell \circ f, 1_A ) \times 
    \sum_{r \in \BipHom(A, B)} \Id (f \circ r , 1_B ) \, ,
\]
and type of bipointed equivalences between $A$ and $B$ is defined by letting
\[
\BipEquiv(A, B)
\defeq    
\sum_{f \in \BipHom(A,B)} \, \isbipequiv(f)  \, . 
\] 
Clearly, the identity morphism on a bipointed type is a bipointed equivalence. The next lemma
gives an alternative characterisation of bipointed equivalences.

\begin{lemma}\label{BoolAlgSpace}  \label{thm:usemere}
A bipointed morphism $(f, \bar{f}_0, \bar{f}_1) \co A \to B$ is a bipointed equivalence if and only
if its underlying function $f \co A \to B$ is an equivalence. Furthermore, there is an equivalence of types
\[
\isbipequiv(f, \bar{f}_0, \bar{f}_1)  \simeq \isequiv(f) \, .
\]
Thus, for any bipointed morphism $f$, the type $\isbipequiv(f)$ is a mere proposition.
\end{lemma}  

\begin{proof}
Let $(A,a_0,a_1), (B,b_0,b_1)$ be bipointed types and $(f, \bar{f}_0, \bar{f}_1) \co A \to B$ be a bipointed morphism between them. Expanding the type of 
proofs that $f$ is a bipointed equivalence yields the type
\[
 \sum_{\ell \co B \to  A}  
 \sum_{\bar{\ell}_0 \co \ell(b_0) \Rightarrow a_0} 
 \sum_{\bar{\ell}_1 \co \ell(b_1) \Rightarrow a_1} 
 P(\ell,\bar{\ell}_0,\bar{\ell}_1) \times 
 \sum_{r \co B \to A} 
 \sum_{\bar{r}_0 \co r(b_0) \Rightarrow a_0} 
 \sum_{\bar{r}_1 \co  r(b_1) \Rightarrow a_1} 
 Q(r,\bar{r}_0,\bar{r}_1)   \, ,
\]
where
\begin{align*}
P(\ell,\bar{\ell}_0,\bar{\ell}_1) & \defeq \Id \Big( \big( \ell \comp f, \ell(\bar{f}_0) \ct \bar{\ell}_0, \ell(\bar{f}_1) \ct \bar{\ell}_1\big), \big( 1_A, \refl(a_0), \refl(a_1) \big) \Big)  \, , \\
Q(r,\bar{r}_0,\bar{r}_1) & \defeq \Id \Big( \big( f \comp h,   f(\bar{r}_0) \ct \bar{f}_0, f(\bar{r}_1) \ct \bar{f}_1  \big) \, , \big( 1_B, \refl(b_0), \refl(b_1) \big) \Big) \, .
\end{align*}
Using the characterization of paths in $\Sigma$-types, the type $P(\ell,\bar{\ell}_0,\bar{\ell}_1)$ can be equivalently expressed as
\[
\sum_{p \co \ell \comp f \Rightarrow 1_A}  
\Id \Big(  \big( \ell (\bar{f}_0) \ct \bar{\ell }_0, \ell (\bar{f}_1) \ct \bar{\ell }_1\big), \big( p_{!}\big(\refl(a_0), \refl(a_1) \big) \big) \Big) \, .
\]
By path elimination on $p$, the transport $p_{!}\big(\refl(a_0), \refl(a_1) \big)$ is equal to the pair 
\[
\big(  \ext(p)_{a_0} \ct \refl(a_0) \, , \;  \ext(p)_{a_1} \ct \refl(a_1) \big) \, ,
\]
where $\ext : \Id(\ell \comp f, 1_A) \to \Hot(\ell \comp f,  1_A)$ is the canonical function, asserted to be an equivalence by the Function Extensionality axiom. This is of course propositionally equal to $\big(\ext(p)_{a_0}, \ext(p)_{a_1} \big)$. Using the characterization of paths in product spaces, the type $P(\ell,\bar{\ell}_0,\bar{\ell}_1)$ can thus be expressed as
\[
\sum_{ p : \ell \comp f \Rightarrow 1_A} \Big(
\Id  \big( \ell (\bar{f}_0) \ct \bar{\ell}_0 \, ,  \ext(p)_{a_0} \big) 
\times 
\Id \big( \ell(\bar{f}_1) \ct \bar{\ell}_1 \, ,  \ext(p)_{a_1} \big)
\Big) \, .
\]
Since the function $\ext$ is an equivalence, this is equivalent to
\begin{align*}
\sum_{\alpha : \ell \comp f \sim 1_A} 
\Big( \Id  \big( \ell (\bar{f}_0) \ct \bar{\ell}_0 \, ,  \alpha(a_0) \big) 
\times 
\Id \big( \ell(\bar{f}_1) \ct \bar{\ell}_1 \, ,  \alpha(a_1) \big) 
\Big) \, .
\end{align*}
Analogously, the type $Q(r,\bar{r}_0,\bar{r}_1)$ is equivalent to
\[
\sum_{\beta : f \comp r \sim 1_B}
\Big(
\Id  \big( f (\bar{r}_0) \ct \bar{f}_0 \, ,  \beta(b_0) \big) 
\times 
\Id \big( f(\bar{r}_1) \ct \bar{f}_1 \, ,  \beta(b_1) \big)
\Big) \, .
\]
Therefore, we can express $\isbipequiv(f, \bar{f}_0, \bar{f}_1)$ as the type
\[
\sum_{\ell \co B \to  A} 
\sum_{\alpha : \ell \comp f \sim 1_A}
\sum_{ r \co B \to A} 
\sum_{\beta : f \comp r \sim 1_B} 
	R_0(\ell,\alpha) \times R_1(\ell,\alpha) \times S_0(r,\beta) \times S_1(r,\beta)
\]
where, for $k = 0,1$, we set
\begin{align*}
& R_k(\ell,\alpha) \defeq \sum_{\bar{\ell}_k : \ell(b_k) \Rightarrow a_k} \Id \big( \ell (\bar{f}_k) \ct \bar{\ell}_k \, ,  \alpha(a_k) \big) \\
& S_k(r,\beta) \defeq \sum_{\bar{r}_k : r(b_k) \Rightarrow a_k} \Id \big( f (\bar{r}_k) \ct \bar{f}_k \, ,  \beta(b_k) \big) 
\end{align*}
Now recall  that for paths $q \in \Id(y,x_1)$, $s \in \Id(y,x_2)$, the type 
\[
\sum_{p \in \Id_X(x_1,x_2)} \Id(q \ct p,s)
\] 
is contractible. Thus we have $R_k(\ell,\alpha) \simeq \one$.
Furthermore, for any equivalence $g : X \to Y$, and paths $q \in \Id(g(x_2),y)$, $s \in \Id(g(x_1),y)$, the type 
\[
\sum_{p \in \Id_X(x_1,x_2)} \Id(g(p) \ct q,s)
\] is contractible. Since $\ell, \alpha, r, \beta$ make $f$ into an equivalence, we have $S_k(\ell,\alpha) \simeq \one$. Thus,
\begin{align*} 
\isbipequiv(f,\bar{f}_0, \bar{f}_1) 
  & \simeq   \sum_{\ell \co B \to A} \sum_{\alpha : \ell \comp f \sim 1_A} \sum_{ r  \co B \to A} 
 \sum_{\beta \co f \comp r \sim 1_B} \, 1 \\
 & \simeq \sum_{\ell \co B \to A}  \Hot( \ell \comp f , 1_A ) \times 
\sum_{r  \co B \to A}  \Hot( f \comp r, 1_B ) \\
 & \simeq \isequiv(f) \, ,
\end{align*} 
as required.
\end{proof}



We now present an equivalent description of the identity type between two bipointed morphisms, which 
will be useful in the proof of Theorem~\ref{thm:bipointedmain}. We begin by introducing the notion of a bipointed homotopy between bipointed morphisms.





\begin{definition}\ \label{thm:biphomotopy} For bipointed morphisms $(f, \bar{f}_0, \bar{f}_1) , (g, \bar{g}_0, \bar{g}_1) \co A \to B$, a~\emph{bipointed homotopy} 
\[
(\alpha, \bar{\alpha}_0, \bar{\alpha}_1) \co (f, \bar{f}_0, \bar{f}_1) \to  (g, \bar{g}_0, \bar{g}_1)
\] 
consists of a homotopy $\alpha \co  f \sim g$ and paths
$\bar{\alpha}_0 \co   \bar{f}_0 \Rightarrow \alpha(a_0)  \cdot \bar{g}_0$ and $\bar{\alpha}_1 \co 
\bar{f}_1 \Rightarrow \alpha(a_1) \cdot \bar{g}_1$. 
\end{definition}

The type of bipointed homotopies between $f$ and $g$ is then defined by letting
\[
 \BipHot  \big( (f,\bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) \big)   \defeq   
 \sum_{\alpha \co f \sim g}  \big( 
  \Id\big( \bar{f}_0 ,  \alpha(a_0)  \ct \bar{g}_0 \big) \times 
  \Id \big( \bar{f}_1,  \alpha(a_1) \ct  \bar{g}_1 \big) \big) \, .
\]
As usual, we often refer to a bipointed homotopy by mentioning only its underlying homotopy.
Diagrammatically, we represent the paths  involved in a bipointed homotopy as follows:
\[
\xymatrix@C=1.5cm{
f(a_k) \ar[r]^{\alpha(a_k)}  \ar@/_1pc/[dr]_{\bar{f}_k}  
\ar@{}[dr]|{\qquad \Rightarrow \; \bar{\alpha}_k}  & g(a_k) \ar[d]^{\bar{g}_k}  \\ 
 & b_k }
  \] 
where $k = 0, 1$. 


\begin{lemma} \label{BoolHomSpace} 
For every parallel pair of morphisms $(f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) \co A \to B$ of bipointed types, there is an equivalence of types
\[
\BipHot\big( (f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) ) \big) \simeq 
\Id \big( (f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) \big)\, .
\]
\end{lemma}

\begin{proof} Let  $f = (f, \bar{f}_0, \bar{f}_1)$ and $g = (g, \bar{g}_0, \bar{g}_1)$ be bipointed
morphisms from $A$ to $B$. To simplify notation, for a path $p \in \Id( f, g)$, we write $\alpha_p \co f \sim g$
for the corresponding homotopy. We then have
\begin{align*}
\BipHot \big( (f,\bar{f}_0,\bar{f}_1) \; (g,\bar{g}_0,\bar{g}_1) \big) & \deq  
\sum_{\alpha : f \sim g} \Id(\bar{f}_0, \alpha(a_0) \ct \bar{g}_0) \times \Id(\bar{f}_1, \alpha(a_1) \ct \bar{g}_1) \\ 
& \simeq \sum_{p  \co  f \Rightarrow g} \Id(\bar{f}_0, \alpha_p(a_0) \ct \bar{g}_0) \times \Id( \bar{f}_1, \alpha_p(a_1) \ct \bar{g}_1) \\
& \simeq
\sum_{p \co f \Rightarrow g} \Id\big( (\bar{f}_0,\bar{f}_1),  \big(\alpha_p(a_0) \ct \bar{g}_0 \, ,  \alpha_p(a_1) \ct \bar{g}_1) \big) \\
& \simeq
\sum_{p \co  f \Rightarrow g} \Id \big(  (\bar{f}_0,\bar{f}_1),  p^{\ast} (\bar{g}_0,\bar{g}_1) \big) \\
& \simeq  \Id \big( (f,\bar{f}_0,\bar{f}_1) , (g,\bar{g}_0,\bar{g}_1)  \big) \, ,
\end{align*} 
as required.
\end{proof}





\begin{definition} \label{def:fibbipointed}
Let $A = (A, a_0, a_1)$ be a bipointed type. A \emph{fibered bipointed type} over $A$ is a dependent type
$E \co A \to \U$ equipped with distinguished elements $e_0 \in E(a_0)$ and $e_1 \in E(a_1)$.
\end{definition}

The type of  fibered bipointed types over a bipointed type $A$ is then defined by letting
\[
\FibBip(A) \defeq \sum_{E \co A \to \U} E(a_0) \times E(a_1)  \, .
 \]
 Note that this type is not small. 
Given a fibered bipointed type $E \co A \to \U$, its total type is defined by letting
\[
E'  \defeq \sum_{x \in A} E(x) \, .
\] 
Observe that $E'$ is a bipointed type by considering $e'_k \defeq \pair(a_k, e_k)$, 
for $k =  0, 1$. In this way, the first projection $\pi_1 \co E' \to A$ becomes a bipointed morphism:
\[
\xymatrix{
1 \ar@/_1pc/[dr]_{a_0} \ar[r]^-{e'_0} & E' \ar[d]^{\pi_1} & 1 \ar[l]_-{e'_1} \ar@/^1pc/[dl]^{a_1} \\ 
 & A \, .& }
 \]



\begin{definition} \label{def:fibsection} Let $E = (E, e_0, e_1)$ be a fibered bipointed type over
$A = (A, a_0, a_1)$.  A \emph{bipointed section} of $E$, 
\[
(s, \bar{s}_0, \bar{s}_1) \co A \to E \, ,
\]
consists of a section $s \in \prod_{x \in A} E(x)$ equipped with paths~$\bar{s}_0 \co s(a_0) \Rightarrow e_0$ 
and $\bar{s}_1 \co  s(a_1) \Rightarrow e_1$. 
\end{definition} 


The type of bipointed sections of $E \co A \to \U$ is then defined to be
\[
\BipSec(E) \defeq \sum_{s \in \prod_{x \in A} E(x)} \Id(s(a_0),  e_0)  \times \Id( s(a_1), e_1)  \, .
\]
Given a bipointed section $s \co A \to E$, we can define a bipointed morphism~$f  \co A \to E'$, where $E'$ is the
total bipointed type associated to $E$. Its underlying function is given by 
letting~$f(x) \defeq \pair(x, s(x))$, for~$x \in A$. With this definition, it is 
immediate to get the path~$\bar{s}_k \co f'(a_k) \Rightarrow e'_k$, for $k = 0, 1$.
The morphism $f' \co A \to E'$ provides a section in the usual category-theoretic sense, \ie a right inverse for~$\pi_1 \co E' \to A$,
 since, for~$x \in A$, we have judgemental equalities
\[
 (\pi_1 \circ f')(x) \deq \pi_1 (f'(x)) \deq \pi_1 (\pair(x, f x)) \deq x \, .
\]
 We represent this situation with the diagram
\[
\xymatrix{
E' \ar[d]_{\pi_1} \\
A . \ar@/_1.2pc/[u]_{f'} }
\]
We conclude this section by characterizing the identity type between two bipointed sections, using
the notion of a bipointed homotopy. This is in complete analogy with the situation for bipointed
morphisms discussed earlier (cf.\,Lemma~\ref{BoolHomSpace}). 


\begin{definition} \label{def:2cellsection} Let $E$ be a fibered bipointed type over $A$. If $f = (f, \bar{f}_0,\bar{f}_1)$ and $g = (g, \bar{g}_0, \bar{g}_1)$ are bipointed sections of $E$, a \emph{bipointed homotopy} 
$(\alpha, \bar{\alpha}_0, \bar{\alpha}_1) \co (f, \bar{f}_0, \bar{f}_1)  \rightarrow (g, \bar{g}_0, \bar{g}_1)$ 
is a homotopy~$\alpha \co f \sim g$ together with paths $\bar{\alpha}_0 \co  f(a_0) \Rightarrow  g(a_0)$ and $\bar{\alpha}_1 \co f(a_1) \Rightarrow g(a_1)$. 
\end{definition} 

The type of bipointed homotopies between bipointed sections $f$ and $g$ as above is then defined by letting:
\[
\BipHot \big( (f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) \big) \defeq
\sum_{\alpha \co f \sim g} \Id ( f(a_0), g(a_0) ) \times \Id ( f(a_1) , g(a_1) ) \, .
\]


\begin{lemma} \label{thm:biphot}
Let $E = (E, e_0, e_1)$ be a fibered bipointed type over $A = (A, a_0, a_1)$. 
For every pair of bipointed sections $f = (f, \bar{f}_0, \bar{f}_1)$ and $g = (g, \bar{g}_0, \bar{g}_1)$, 
there is an equivalence of types
\[
\BipHot \big( (f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) \big)
\simeq 
\Id\big( (f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) \big) \, .
\]
\end{lemma}


\begin{proof} The claim follows by an argument analogous to that of Lemma~\ref{BoolHomSpace}.
\end{proof}







\section{Homotopy-initial bipointed types} 
\label{sec:homibt}


Let $A \in \U$ be a small type and assume that it is equivalent to $\Bool$. Then, $A$ admits the structure of a bipointed type and
it satisfies the counterparts of the elimination and computation rules for $\Bool$ in which the computation rule is 
weakened by replacing the judgmental equality in its conclusion with a propositional equality. Using the notions of a fibered bipointed type and of a bipointed section introduced in Section~\ref{sec:bip}, it is immediate to see that the these rules rules assert that every fibered bipointed type over $A$ has a bipointed section. Since bipointed types $A$ of this kind  play an important role in the following, we introduce some terminology to refer to them.


 



\begin{definition} A bipointed type $A$ is said to be \emph{inductive} if every fibered bipointed type over it has a bipointed section, \ie the type
\[ 
\isind(A) \defeq \prod_{E \in \FibBip(A)}  \BipSec(E)
\]  
is inhabited. \end{definition} 

Consequently, the type of (small) inductive bipointed types is given by
\[
\mathsf{BipInd} \defeq \sum_{A \in \Bip} \isind(A) \, .
\]
Thus, a canonical inductive bipointed type is given by a bipointed type $A = (A, a_0, a_1)$ together with a function 
which, given a fibered bipointed type $E = (E, e_0, e_1)$ over $A$, returns a bipointed section of $E$.
Clearly, the type $\Bool$ is an inductive bipointed type. Furthermore, the property of being inductive can be transported along equivalences, in the sense that if $A$ and $B$ are equivalent bipointed types and $A$ is inductive, then so is $B$. Thus, a
type is equivalent to $\Bool$ if and only if it is inductive. Below,
we begin to explore some consequences of the assumption that a bipointed type is inductive, so as to give a 
characterisation of inductive bipointed types.



\begin{proposition} \label{thm:inductiverules}
Let $A = (A, a_0, a_1)$ be a bipointed type. Then $A$ is inductive if only if it satisfies the following rules:

\begin{mathpar}
\begin{prooftree}
x \in A \vdash E(x) \in \U \qquad
e_0 \in E(a_0) \qquad
e_1 \in E(a_1) \qquad
\justifies
x \in A \vdash s(x, e_0, e_1) \in E(x) \, , 
\end{prooftree} \\ \medskip
\begin{prooftree}
x\in A \vdash E(x) \in \U \qquad
e_0 \in E(a_0) \qquad
e_1 \in E(a_1)
\justifies
\bar{s}_k \in \Id \big(    s(a_k, e_0, e_1), e_k \big) \, ,
\end{prooftree}  
\end{mathpar}
where $k = 0, 1$.
\end{proposition}

\begin{proof} Immediate.
\end{proof}

Note that the rules in Proposition~\ref{thm:inductiverules} are exactly the elimination rule
and the weakening computation rules for $\Bool$ obtained by replacing the judgemental
equality in the conclusion with a propositional one, as mentioned above.
We now show that if a bipointed type $A$ is inductive, then not only 
every fibered bipointed type over it has a bipointed section, but this section
is unique up to a bipointed homotopy.

\begin{lemma} \label{thm:inductiveuniquesec} Let $A = (A, a_0, a_1)$ be a bipointed type. If $A$ is inductive, 
then the following rules are derivable:

\[
\begin{prooftree}
(E, e_0, e_1) \in \FibBip(A) \quad
(s, \bar{s}_0, \bar{s}_1) \in \BipSec(E) \quad
(t, \bar{t}_0, \bar{t}_1) \in \BipSec(E) 
\justifies
x \in A \vdash \varphi(x) \in \Id( s(x), t(x))
\end{prooftree} \bigskip
\]

\[
\begin{prooftree}
(E, e_0, e_1) \in \FibBip(A) \quad
(s, \bar{s}_0, \bar{s}_1) \in \BipSec(E) \quad
(t, \bar{t}_0, \bar{t}_1) \in \BipSec(E) 
\justifies
\bar{\varphi}_k \in \Id( \bar{s}_k, \varphi(a_k) \cdot \bar{t}_k) 
\end{prooftree}
\]
\noindent
where $k = 0, 1$.
\end{lemma}

\begin{proof} For the first rule, let us assume its premisses and, for $x \co A$, define
\[
 E'(x) \defeq \Id_{E(x)} \big( s(x), t(x) \big) \, .
\]
This is a fibered bipointed type over $A$, since for $k = 0, 1$, we have an element $e'_k \co E'(a_k)$  defined by letting
$e'_k  \defeq \bar{s}_k \cdot \bar{t}_k^{-1}$.  By the assumption that $A$ is inductive, there exists a bipointed section of $E'$, say $\varphi  \in \prod_{x \in A} E'(x)$. 
For $x \in A$, we then have
\[
\varphi(x) \in \Id_{E(x)} \big(  s(x), t(x) \big)  \, ,
 \]
 as required. The other rules  can be obtained very easily. Indeed, since $\varphi$ is a bipointed section, we
 have paths $\bar{\varphi}_k \in \Id( \varphi(a_k), e'_k)$, for $k = 0, 1$. The conclusion now follows by the definition of $e'_k$ and the groupoid laws for
 composition of paths. 
 \end{proof} 
 
 \medskip
 
 ADD REMARK ON ETA-RULES.
 
 \medskip

Proposition~\ref{thm:inductiverules} and Lemma~\ref{thm:inductiveuniquesec}
imply that if $A$ is a inductive bipointed type then, for every bipointed type $B$, 
there exists a bipointed morphism~$f \co A \to B$, which is unique in the sense that  for any two bipointed morphisms $(f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1) \co A \to B$  there is a bipointed homotopy~$\alpha \co f \sim g$. Thus, by Lemma~\ref{BoolHomSpace}, there is a path 
\[
p \in \Id((f, \bar{f}_0, \bar{f}_1), (g, \bar{g}_0, \bar{g}_1)) \, .
\] 
Furthermore, it can be shown that such a path is itself is unique up to a higher path, which in turn is unique up to a yet higher path, etc... As we will show in the reminder of this section, this sort of weak $\infty$-universality, which apparently involves infinitely much data, can nonetheless be fully captured within the system of type theory (without resorting to coinduction) using ideas inspired by homotopy theory and higher-dimensional category theory. Indeed, in spite of the fact that bipointed types and morphisms do not form a category in a strict sense, it is possible to introduce the  notion of a homotopy-initial bipointed type in completely elementary and explicit terms, as we do in the next definition.


\begin{definition}\label{def:BoolInit}
A bipointed type $A$ is said to be \emph{homotopy-initial}  if for any bipointed type $B$, the type $\BipHom(A,B)$ of bipointed morphisms from $A$ to $B$
is contractible, \ie the type
\[
\prod_{B \in \Bip} \, \iscontr(\BipHom(A, B) )
\] 
is inhabited.
\end{definition}

Let us remark that the uniqueness implicit in Definition~\ref{def:BoolInit} requires that any two bipointed homomorphisms are propositionally equal as tuples. It should also be noted that the property of being  homotopy-initial  can be transported along equivalences, in the sense that if two bipointed types are equivalent, then one is homotopy-initial if and only if the other one is. It is worth emphasizing also that homotopy-initiality is a purely type-theoretic notion: despite having an intuitive homotopy-theoretic interpretation, it is formulated in terms of inhabitation of specific, definable types. In fact, it is possible to give a characterization of homotopy-initial bipointed types in terms of type-theoretic rules, as the next proposition spells out.

\begin{proposition} \label{thm:hinitrules}
A bipointed type $A = (A, a_0, a_1)$ is homotopy-initial if and only if it satisfies
 the following rules:
 \begin{mathpar}
\begin{prooftree}
B \in \U \qquad
b_0 \in B \qquad
b_1 \in B \qquad
\justifies
x \in A \vdash f(x, b_0, b_1) \in B 
\end{prooftree} \\ \medskip
\begin{prooftree}
B \in \U \qquad
b_0 \in B  \qquad
b_1 \in B
\justifies
\bar{f}_k \in \Id(  f(a_k, b_0, b_1), b_k ) 
\end{prooftree}   \\ \medskip

\begin{prooftree}
(B, b_0, b_1) \in \Bip \quad
(f, \bar{f}_0, \bar{f}_1) \in \Bip(A,B) \quad
(g, \bar{g}_0, \bar{g}_1) \in \Bip(A,B) 
\justifies
x \in A \vdash \alpha(x) \in \Id( f(x), g(x))
\end{prooftree}  \\ \medskip

\begin{prooftree}
(B, b_0, b_1) \in \Bip \quad
(f, \bar{f}_0, \bar{f}_1) \in \Bip(A,B) \quad
(g, \bar{g}_0, \bar{g}_1) \in \Bip(A,B) 
\justifies
\bar{\alpha}_k \in \Id( \bar{f}_k, \alpha(a_k) \cdot \bar{g}_k) 
\end{prooftree}
\end{mathpar}
 where $k =  0, 1$.
\end{proposition}



\begin{proof} Immediate.
\end{proof} 


\medskip
 
 ADD REMARK ON ETA-RULES.
 
 \medskip




The next theorem provides the characterisation of inductive bipoinited types.






\begin{theorem}\label{thm:bipointedmain} A bipointed type 
is  $A$ is inductive if and only if it is homotopy-initial, \ie  the type
\[
\prod_{A \in \Bip} \big(  \ishinit(A) \leftrightarrow \isind(A) \big)
\] 
is inhabited
\end{theorem}

\begin{proof} Let $A = (A, a_0, a_1)$ be a bipointed type. First, we show that if $A$ is inductive then
it is homotopy-initial. But this follows immediately observing that the rules characterising homotopy-initial bipointed types in Proposition~\ref{thm:hinitrules}
are special cases of the rules in Proposition~\ref{thm:inductiverules} and Lemma~\ref{thm:inductiveuniquesec},
which are provable for inductive bipointed types. For the other implication, 
let us assume that $A = (A, a_0, a_1)$ is homotopy-initial and prove that it is inductive. 
For this, let $E = (E, e_0, e_1)$ be a fibered bipointed type over $A$. We need to show that there
exists a bipointed section
\begin{equation}
\label{equ:reqsec}
(s, \bar{s}_0, \bar{s}_1) \co A \to E
\end{equation}
Let us begin by considering the total bipointed type associated to $E$, with carrier 
\[
E' \defeq \sum_{x \in A} E(x) 
\]
and distinguished elements $e'_k \defeq \pair(a_k, e_k)$ for $k = 0, 1$. In this way,  the first projection $\pi_1 \co E' \to A$ is a bipointed morphism. By the homotopy-initiality of $A$, we have a bipointed morphism 
\[
(f, \bar{f}_0, \bar{f}_1) \co (A, a_0, a_1)  \to (E', e'_0, e'_1) 
\]
which we represent with the diagram
\[
\xymatrix{
1 \ar@/_1pc/[dr]_{e'_0} \ar[r]^{a_0} & A  \ar[d]^f & 1 \ar[l]_{a_1} \ar@/^1pc/[dl]^{e'_1} \\
 & E' & }
 \]
 We can compose $f \co A \to E'$ with $\pi_1 \co E' \to A$ and obtain a bipointed morphism $\pi_1 \co f \co A \to A$, represented by the diagram
  \[
\xymatrix@C=1.5cm{
1 \ar@/_1pc/[dr]_(.7){e'_0} \ar[r]^{a_0} \ar@/_1.5pc/[ddr]_{a_0}  & A  \ar[d]^f & 1 \ar[l]_{a_1} \ar@/^1pc/[dl]^(.7){e'_1} \ar@/^1.5pc/[ddl]^{a_1}  \\
 & E' \ar[d]^{\pi_1} & \\
 & A &  }
 \]
But the identity $1_A \co A \to A$ is also a bipointed morphism from $A$ to itself and hence, by the homotopy-initiality of $A$, there is a path
\begin{equation}
\label{equ:pathcrucial}
\pi_1 \circ f \Rightarrow 1_A 
\end{equation}
in $\Bip(A,A)$. By Lemma~\ref{BoolHomSpace}, there  is a bipointed homotopy $(\alpha,
\bar{\alpha}_0,\bar{\alpha}_1) \co \pi_1 \circ f \sim 1_A$. This gives us a homotopy $\alpha \co \pi_1 \circ f \sim 1_A$ and paths
\begin{equation*}
\bar{\alpha}_k \co \overline{(\pi_1 f)}_k \Rightarrow \alpha(a_k) \cdot \refl(a_k) 
\end{equation*}
for $k = 0, 1$. We begin to define the required bipointed section as in~\eqref{equ:reqsec}, by defining, for~$x \in A$, 
\begin{equation}
\label{equ:defreqsection}
s(x) \defeq \alpha(x)_{!} \big( \pi_2 f (x) \big) \, .
\end{equation}
We now construct  paths~$\bar{s}_k \co s(a_k) \Rightarrow e_k$, for $k = 0, 1$. First of all, recall that 
$\bar{f}_k \co  f(a_k) \Rightarrow  e'_k$, where $e'_k = \pair(a_k, e_k) \in \sum_{x \in A} E(x)$. Using the equivalence
\[
\ext_E \co \Id_{E'}( f(a_k), e'_k) \longrightarrow \sum_{p \co  \pi_1 f(a_k) \Rightarrow a_k} \, \Id_{E(a_k)} \big( p_{!}( \pi_2 f(a_k)) , e_k \big) \, ,
\]
we obtain paths 
\begin{equation}
\label{equ:usefulpath}
p \co   \pi_1 f (a_k) \Rightarrow a_k  \, , \quad q \co   p_{!}( \pi_2 f (a_k)) \Rightarrow e_k   \, .
\end{equation}
Furthermore, we have 
\begin{alignat*}{4}  
\overline{(\pi_1 f)}_k  & \Rightarrow \pi_1(\bar{f}_k) \ct (\overline{\pi_1})_k & & \qquad (\text{by definition of } \pi_1 f)   \\
& \Rightarrow \pi_1(\bar{f}_k) \ct \refl(a_k) & & \qquad (\text{by definition of } \pi_1)  \\
 & \Rightarrow \pi_1(\bar{f}_k) & & \qquad (\text{by the groupoid laws}) \\
 & \Rightarrow p  & & \qquad (\text{by definition of } \ext_E) \,  .
\end{alignat*}
Therefore, we can construct the following chain of paths:
\begin{alignat*}{4}
p & \Rightarrow  \overline{(\pi_1 f)}_k & &  \qquad (\text{by what we just proved})  \\
  & \Rightarrow  \alpha(a_k) \ct \refl(a_k) & &  \qquad (\text{by the path } \bar{\alpha}_k ) \\ 
  & \Rightarrow  \alpha(a_k)  & & \qquad (\text{by the groupoid laws})
\end{alignat*} 
Hence,  the required path $\bar{s}_k \co  s(a_k) \Rightarrow e_k$ can be defined as the following composite:
\begin{alignat*}{4}
s(a_k) & \deq \alpha(a_k)_{!} \big( \pi_2 f(a_k)  \big) & & \qquad (\text{by the definition of } s) \\
 &              \Rightarrow   p_{!} \big( \pi_2 f(a_k)  \big) & & \qquad (\text{since there is a path } p \Rightarrow \alpha(a_k)) \\
   &            \Rightarrow  e_k  & &  \qquad (\text{by the path } q \text{ in } \eqref{equ:usefulpath})  \, .
   \end{alignat*} 
   This concludes the proof.
\end{proof}


Obviously, the proof of Theorem~\ref{thm:bipointedmain} simplifies considerably within the extensional
type theory~$\Hext$. In that type theory, the path in~\eqref{equ:pathcrucial} gives a definitional equality 
between the composite $\pi_1 \circ f \co A \to A$ and the identity $1_A \co A \to A$, with which the
rest of the argument can be shortened considerably. In that setting, one obtains the familiar characterisation 
of an inductive type by means of a standard universal property.



\begin{corollary}  Let $A = (A, a_0, a_1)$ be a bipointed type.
\begin{enumerate}[(i)]
\item The type $\ishinit(A)$ is a mere proposition.
\item The type $\isind(A)$ is a mere proposition.
\item There is an equivalence $\ishinit(A) \simeq \isind(A)$. 
\end{enumerate} 
\end{corollary}

\begin{proof} For claim (i), recall that  $\iscontr(X)$ is a mere proposition for any type $X$ and the dependent product of family of mere propositions is again a mere proposition. For (ii), recall that to prove that a type $X$ is a mere proposition, it suffices to do so under the assumption that $X$ is inhabited. Assume therefore that $\isind(A)$ is inhabited. Since the dependent product of a family of mere propositions is again a mere proposition, it suffices to show that $\BipSec(A,E)$ is a mere proposition for any $E$. But for any two sections $s, t \in \BipSec(A,E)$, we know that there is a 
bipointed homotopy $\phi \in \BipHot(s,t)$ by Lemma~\ref{thm:inductiveuniquesec} and hence, by 
Lemma~\ref{thm:biphot}, there is a path $p \in \Id(s,t)$, as required. Part (iii) now follows from parts (i) and (ii) and  the logical equivalence of  Theorem~\ref{thm:bipointedmain}. 
\end{proof}



\begin{corollary}[$\Hint + \Bool$]  For a bipointed type $A = (A, a_0, a_1)$, the following 
conditions are equivalent:
\begin{enumerate}[(i)]
\item $A$ is inductive,
\item $A$ is homotopy-initial,
\item $A$ is equivalent to $\Bool$. \qed
\end{enumerate}
\end{corollary}

We conclude this section by showing that if the universe $\U$ is univalent, then a form of the Univalence Axiom holds also for bipointed types, in the sense made precise by the next theorem.


\begin{theorem}[$\Hint + \mathrm{UA}$] \label{thm:bipunivalence}
For small bipointed types $A, B \in \Bip$, the canonical function
\[ 
\ext_{A,B} \co \Id \big(A,B\big) \to  \BipEquiv(A,B) \, .
\] 
is an equivalence.
\end{theorem} 

\begin{proof} 
Let $ (A,a_0,a_1), (B,b_0,b_1)$ be bipointed types. By the characterization of the identity types
of  elements of a $\Sigma$-type, the 
identity type $\Id\big( (A,a_0,a_1),  (B,b_0,b_1)\big)$ is equivalent to  the type
\[
\sum_{p \in \Id(A,B)} \Id(\pair(a_0,a_1),  p_{!}(\pair(b_0,b_1))) \, .
\]
By path elimination on $p$ and the characterization of paths in product types, this type is equivalent to
\[ 
\sum_{p \in \Id(A,B)} \, \Id \big( f_p(a_0),  b_0\big) \times \Id \big( f_p(a_1) , b_1)
 \]
where we write $f_p \co A \to B$ for the equivalence associated to a path $p \in \Id(a,b)$.  By the Univalence Axiom,
the above type is equivalent to
\[ 
\sum_{f \in \mathsf{Equiv}(A,B)} \, \Id \big( f(a_0),  b_0\big) \times \Id \big( f(a_1) , b_1\big) \]
After rearranging we get
\[
\sum_{(f, \bar{f}_0, \bar{f}_1) \in \BipHom(A,B)} \, \isequiv(f)
\]
which, by Lemma~\ref{BoolAlgSpace}, is equivalent to $\BipEquiv(A,B)$, as desired. Finally, it is not hard to see that the composition of the above equivalences yields the canonical function $\ext$ up to a homotopy.
\end{proof} 

\begin{corollary}[$\Hint + \mathrm{UA}$] \label{BoolHInitIso} 
Homotopy-initial bipointed types are unique up to a contractible type of paths, i.e. the type
\[ 
\prod_{A \in \Bip} \, \prod_{ B \in \Bip}
\big( \ishinit(A) \times \ishinit(B) \to \iscontr(\Id(A,B)) \big) \, .
\] 
is inhabited.
\end{corollary}

\begin{proof} Let $A$ and $B$ be homotopy-initial bipointed types. 
By Theorem~\ref{thm:bipunivalence} it suffices to prove that the type $\BipEquiv(A,B)$ is contractible. The type 
$\BipHom( A, B)$ is contractible by homotopy-initiality of $A$. Since the dependent sum of a family of mere propositions over a mere proposition is again a mere proposition, it suffices to prove that the type $\isbipequiv(f)$ is contractible for any bipointed morphism $f \co A \to B$. This type is a mere proposition by Lemma~\ref{thm:usemere}, and thus it suffices to show it is inhabited. But the existence of a right and a left bipointed inverse for $f$ follows immediately
by the assumption that $A$ and $B$ are homotopy-initial.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Polynomial functors and their algebras}
\label{section:wfiles}


A W-type can be seen informally as the free algebra for a signature
with arbitrarily many operations of possibly infinite arity, but no equations. Indeed, the premises of the formation rule above can be thought of as specifying a signature that has the elements of~$A$ as (names of) operations and in which the arity of $a \in A$ is the cardinality of the type $B(a)$. Then the introduction rule specifies the canonical way of forming an element of the free algebra, and the elimination rule can be seen as the propositions-as-types translation of the appropriate induction principle. Throughout this section and the next, we consider a fixed  $A \in \U$ and $B \co A \to \U$. For $X \in \U$,
we define
\[
P(X) \defeq \sum_{a \in A} X^{B(a)}
\]
In this way, we obtain $P \co \U \to \U$. This operation on small types extends to an operation of functions between 
small types as follows. For $f : X\to Y$, where $X, Y \in \U$, we define $P(f) : P(X)\to P(Y)$ by $\Sigma$-elimination
so that for $(a, t) \in P(X)$ we have 
\[
P(f)(a, t) = (a,f\circ t) \, .
\] 
Although this assignment is not strictly functorial, we still refer to  as the \emph{polynomial functor} associated to $A$ and $B$. 

\begin{definition} A (small) $P$-algebra is a pair $(X, \sup_X)$ consisting of a small type $X \in \U$ and a function
$\sup_X \co P(X) \to X$. 
\end{definition}

 The type of $P$-algebras is then defined as $\Palg  \defeq \sum_{X \in \U} X^{P(X)}$. As usual,  we will often refer to a 
 $P$-algebra by mentioning only to its carrier. We adopt similar conventions for other kinds of structures that we consider
 in the following.  We refer to the function $\sup_X : P(X)\to X$ as the \emph{structure map} of the $P$-algebra.  
 An example of $P$-algebra is given by the W-type $W \defeq \WW_{x\in A} B(x)$ associated to $A$ and $B$, with structure map given by the introduction rule. 
 


\begin{definition}
For $P$-algebras $X$ and $Y$, a \emph{$P$-algebra morphism}
\[
(f, \bar{f}) \co (X, \sup_X) \rightarrow (Y, \sup_Y)
\]
consists of a function $f \co X \rightarrow Y$ and a path $\bar{f} \in \Id( f \circ \sup_X \, ,  \sup_{Y} \circ P f )$.
\end{definition}

For example, for a $P$-algebra $X$, the identity function $1_X \co X \to X$ has an evident structure of
$P$-algebra morphism. The data for a $P$-algebra morphism as above can be represented with a diagram of the form
\[
\xymatrix{
 PX \ar[d]_{\sup_X} \ar[r]^{Pf}  \ar@{}[dr]|{\bar{f}} &  PY \ar[d]^{\sup_Y}\\
X \ar[r]_{f}   & Y }
\] 
Informally, one can think of the path $\bar{f}$ as a proof that the square diagram commutes (which is the 
requirement defining the notion of morphism of endofunctor algebras in category theory). Accordingly, the type of $P$-algebra morphisms between $X$ and $Y$ is defined by
\[
\Palg(X,Y)
 \defeq  
\sum_{f:  X \rightarrow Y} \, \Id(f\circ \sup_X \, ,  \sup_Y \circ P f )  \, .
\]
We now define a composition operation for $P$-algebra morphisms. Given 
$P$-algebra morphisms$(f, \bar{f}) \co X \to Y$ and $(g, \bar{g}) \co Y \to Z$,
we can define their composite 
\[
(g, \bar{g}) \circ (f, \bar{f}) \co (X, \sup_X) \to (Z, \sup_Z)
\] 
as follows. The composite $P$-algebra morphism has $g\circ f\co X \to Z$ as its underlying function. 
The appropriate path, which must be of the form
\[
 \overline{ g \circ f} \co (g\circ f) \circ \sup_X \Rightarrow \sup_Z \circ P(gf)\, .
\]
is obtained by pasting the diagrams 
\[
\xymatrix@C=2cm{
 PX \ar[d]_{\sup_X} \ar[r]^{Pf}  \ar@{}[dr]|{\bar{f}} &  PY \ar[d]^{\sup_Y}  \ar[r]^{Pg}  \ar@{}[dr]|{\bar{g}} &  PZ \ar[d]^{\sup_Z} \\
X \ar[r]_{f}   & Y \ar[r]_{g}   & Z \,  }
\]
We can then compose paths as follows:
\begin{align*}
(g\circ f) \circ \sup_X &  \Rightarrow g \circ (f \circ \sup_X) \\
 & \Rightarrow g \circ ( \sup_Y \circ P f ) \\
 & \Rightarrow (g \circ \sup_Y) \circ Pf \\
 & \Rightarrow (\sup_Z \circ Pg) \circ Pf \\
 & \Rightarrow \sup_Z \circ (Pg \circ Pf) \\
 & \Rightarrow \sup_Z \circ P (g\circ f) 
 \end{align*}
Note that we used the pre-composition and post-compositions of functions with paths. As in the case of bipointed types, we do not quite have a category since the composition operation is not strictly associative, but only so up to a system of higher and higher identities. 

\medskip







\begin{definition} Let $X, Y$ be $P$-algebras. We say that a $P$-morphism $f \co X \to Y$ is a 
\emph{$P$-algebra equivalence}
if there exist $P$-morphisms $\ell,r \co Y \to X$  which provide a left and a right $P$-inverse for $f$ as a
$P$-algebra morphism, \ie for
which there are paths between $P$-algebra morphisms
\[ 
p \in \Id( \ell \circ f,  1_X) \, , \quad q \in \Id( f \circ r , 1_Y) \, .
\]
\end{definition}

For example, the identity morphism on a $P$-algebra is a $P$-equivalence, with the left and right inverses given by the identity morphism itself. Given $P$-algebras $X$ and $Y$ and a function $f \co X \to Y$, we define the type of proofs that $f$ is an equivalence of $P$-algebras as follows:
\[
\mathsf{is}\text{-}P\text{-}\mathsf{equiv}(f) \defeq   \sum_{\ell \in  \Palg(X,Y)} \Id( \ell \circ f, 1_X )  \times 
    \sum_{r  \in \Palg(Y, X)} \Id( f \circ r , 1_Y ) \, .
\]
We then define the type of \emph{$P$-algebra equivalences} between $X$ and $Y$ as
\[
\mathsf{PEquiv}(X, Y)
\defeq    \sum_{f : \Palg(X,Y)} \mathsf{is}\text{-}P\text{-}\mathsf{equiv}(f)  \, . 
\] 


\begin{lemma}\label{WAlgSpace} A $P$-algebra morphism $(f, \bar{f}) \co X \to Y$ is an equivalence of
$P$-algebras if and only
if its underlying function $f \co X \to Y$ is an equivalence. Furthermore, there is an equivalence of types
\[
\mathsf{isPequiv}(f, \bar{f})  \simeq \mathsf{isequiv}(f) \, . 
\]
\end{lemma}  


\begin{proof}
Let $(C,c), (D,d)$ be $P$-algebras and $(f, \bar{f})$ be a $P$-morphism between them. Expanding the type of proofs that $f$ is a $P$-equivalence yields the type
\begin{multline*}
 \Big(\big(\Sigma \ell \co D \to  C \big) \big(\Sigma \bar{\ell} : (\Pi a) (\Pi s) \ell(d(a,s))=c(a,\ell \circ s)\big)
P(\ell,\bar{\ell})\Big) \; \times \\ 
 \Big(\big(\Sigma r \co D \to C \big) \big(\Sigma \bar{r} : (\Pi a) (\Pi s) r(d(a,s))=c(a,r \circ s) \big) Q(r,\bar{r})  \Big)\, , 
\end{multline*}
where
\begin{align*}
P(\ell,\bar{\ell}) & \defeq \Id \Big( \big( \ell \comp f, (\lambda a)(\lambda t) \ell(\bar{f}(a,t)) \ct \bar{\ell}(a, f \comp t)\big), \big( 1_C, (\lambda a)(\lambda t) \refl(c(a,t))\big) \Big)  \, , \\
Q(r,\bar{r})    & \defeq \Id \Big( \big( f \comp r, (\lambda a)(\lambda s) f(\bar{r}(a,s)) \ct \bar{f}(a, r \comp s)\big) \, , \big( 1_D, (\lambda a)(\lambda s) \refl(d(a,s)) \big) \Big) \, .
\end{align*}
Using the characterization of paths in $\Sigma$-types, the type $P(\ell,\bar{\ell})$ can be equivalently expressed as
\begin{align*}
\big(\Sigma p : \ell \comp f = \idfun{C} \big) \Big((\lambda a) (\lambda t) \ell(\bar{f}(a,t)) \ct \bar{\ell}(a, f \comp t)\Big) = p^{!} \Big((\lambda a) (\lambda t) \refl(c(a,t))\Big) 
\end{align*}
By path induction on $p$, the transport $p^{!} \Big((\lambda a) (\lambda t) \refl(c(a,t))\Big)$ is equal to the function
\[ (\lambda a) (\lambda t) \ext(p)_{c(a,t)} \ct \refl(c(a,t)) \ct \big(c(a)(\ext^{-1}(\ext(p) \circ t))\big)^{-1} \]
where $\ext : \ell \comp f = \idfun{C} \to \ell \comp f \sim \idfun{C}$ is the canonical equivalence. This is of course propositionally equal to
\[ (\lambda a) (\lambda t) \ext(p)_{c(a,t)} \ct \big(c(a)(\ext^{-1}(\ext(p) \circ t))\big)^{-1} \]
Using the characterization of paths in $\Pi$-spaces, the type $P(\ell,\bar{\ell})$ can thus be expressed as
\begin{align*}
\big(\Sigma p : \ell \comp f = \idfun{C} \big) (\Pi a) (\Pi t) \Big(\ell(\bar{f}(a,t)) \ct \bar{\ell}(a, f \comp t) = \ext(p)_{c(a,t)} \ct \big(c(a)(\ext^{-1}(\ext(p) \circ t))\big)^{-1}\Big)
\end{align*}
Since the function $\ext$ is an equivalence, this is equivalent to
\begin{align*}
\big(\Sigma \alpha : \ell \circ f \sim \idfun{C} \big) (\Pi a) (\Pi t) \Big(\ell(\bar{f}(a,t)) \ct \bar{\ell}(a, f \comp t) = \alpha(c(a,t)) \ct \big(c(a)(\ext^{-1}(\alpha \circ t))\big)^{-1}\Big)
\end{align*}
Analogously, the type $Q(r,\bar{r})$ is equivalent to
\begin{align*}
\big(\Sigma \beta : f \comp r \sim \idfun{D} \big) (\Pi a) (\Pi s) \Big(f(\bar{r}(a,s)) \ct \bar{f}(a, r \comp s) = \beta(d(a,s)) \ct \big(d(a)(\ext^{-1}(\beta \circ s))\big)^{-1}\Big)
\end{align*}
Therefore, we can express $\mathsf{isPequiv}(f,\bar{f})$ as the type
\[ \big(\Sigma \ell : D\to C) \big(\Sigma \alpha : \ell \circ f \sim \idfun{C}\big) \big(\Sigma r : D\to C) \big(\Sigma \beta : f \circ r \sim \idfun{D}\big) R(\ell,\alpha) \times S(r,\beta)\]
where
\begin{align*}
& R(\ell,\alpha) \defeq \big(\Sigma \bar{\ell} : (\Pi a) (\Pi s) \ell(d(a,s))=c(a,\ell \circ s)\big) (\Pi a) (\Pi t) \\ & \;\;\;\;\;\;\;\;\;\;\;\; \Big(\ell(\bar{f}(a,t)) \ct \bar{\ell}(a, f \comp t) = \alpha(c(a,t)) \ct \big(c(a)(\ext^{-1}(\alpha \circ t))\big)^{-1}\Big) \\
& S(r,\beta) \defeq \big(\Sigma \bar{r} : (\Pi a) (\Pi s) r(d(a,s))=c(a,r \circ s) \big) (\Pi a) (\Pi s) \\ & \;\;\;\;\;\;\;\;\;\;\;\; \Big(f(\bar{r}(a,s)) \ct \bar{f}(a, r \comp s) = \beta(d(a,s)) \ct \big(d(a)(\ext^{-1}(\beta \circ s))\big)^{-1}\Big)
\end{align*}
Using the global choice principle, we can express the type $S(r,\beta)$ equivalently as
\[  (\Pi a) (\Pi s) \big(\Sigma \bar{r} : r(d(a,s))=c(a,r \circ s) \big) \Big(f(\bar{r}) \ct \bar{f}(a, r \comp s) = \beta(d(a,s)) \ct \big(d(a)(\ext^{-1}(\beta \circ s))\big)^{-1}\Big) \, .
\]
Now we observe that for any equivalence $g : X \to Y$, and paths $q : \Id(g(x_2),y)$, $s : \Id(g(x_1),y)$, the type $\big(\Sigma p : \Id_X(x_1,x_2)\big) \Id(g(p) \ct q,s)$ is contractible. Since $\ell, \alpha, r, \beta$ make $f$ into an equivalence, we have $S(r,\beta) \simeq \one$.

Since $f$ is an equivalence between $C$ and $D$, the mapping $t \mapsto f \comp t$ is an equivalence between $B(a) \to C$ and $B(a) \to D$. The mapping $\bar{\ell} \mapsto (\lambda a) (\lambda t) \bar{\ell}(a,f \comp t)$ is therefore an equivalence between the types $(\Pi a) (\Pi s) \ell(d(a,s)) = c(a,\ell \comp s)$ and $(\Pi a) (\Pi t) \ell(d(a,f \comp t)) = c(a,\ell \comp f \comp t)$. Thus, the type type $R(\ell,\alpha)$ can be expressed equivalently as
\begin{align*}
& \big(\Sigma \gamma : (\Pi a) (\Pi t) \ell(d(a,f \circ t))=c(a,\ell \circ f \circ t)\big) (\Pi a) (\Pi t) \\ & \;\;\;\;\;\;\;\;\;\;\;\; \Big(\ell(\bar{f}(a,t)) \ct \gamma(a,t) = \alpha(c(a,t)) \ct \big(c(a)(\ext^{-1}(\alpha \circ t))\big)^{-1}\Big)
\end{align*}
Furthermore, using the global choice principle we see that this is equivalent to
\[ (\Pi a) (\Pi t) \big(\Sigma \gamma : \ell(d(a,f \circ t))=c(a,\ell \circ f \circ t)\big) \Big(\ell(\bar{f}(a,t)) \ct \gamma = \alpha(c(a,t)) \ct \big(c(a)(\ext^{-1}(\alpha \circ t))\big)^{-1}\Big) \]
Now we observe that for paths $q : \Id(y,x_1)$, $s : \Id(y,x_2)$, the type $\big(\Sigma p : \Id_X(x_1,x_2)\big) \Id(q \ct p,s)$ is contractible. Thus we have $R(\ell,\alpha) \simeq \one$. Therefore,
\begin{align*} 
\mathsf{isPequiv}(f,\bar{f}) 
  & \simeq   \big(\Sigma \ell \co D \to C \big) \big(\Sigma \alpha : \ell \comp f \sim 1_C \big) \big(\Sigma r  \co D \to C \big) 
 \big(\Sigma \beta \co f \comp r \sim 1_D \big) \, 1 \\
 & \simeq \big(\Sigma \ell \co D \to C \big)  \big( \ell \comp f \sim 1_C \big) \times 
 \big(\Sigma r  \co D \to C \big) \big( f \comp r \sim 1_D \big) \\
 & \simeq \isequiv(f) \, ,
\end{align*} 
as required.
\end{proof}


We require an alternative description of the identity type between two $P$-algebra morphisms. For this, we introduce 
the notion of a homotopy between  $P$-algebra morphisms. 


\begin{definition}
For $P$-algebras $X$, $Y$ and $P$-algebra morphisms $(f, \bar{f}) \, , (g, \bar{g}) \co X \to Y$, a \emph{$P$-algebra homotopy}  
$(\alpha, \bar{\alpha}) : (f, \bar{f}) \sim (g, \bar{g})$ consists of a homotopy $\alpha : f \sim g$ together with a path
\[
\bar{\alpha} : \bar{f} \cdot \sup_Y (P \alpha) \Rightarrow \alpha(\sup_X)\cdot \bar{g} \, .
\] 
\end{definition}

Note that the path $\bar{\alpha}$ is between elements of $\Id \big( f \circ \sup_X \, ,  \sup_Y \circ Pf \big)$, where the paths $P\alpha \co Pf \Rightarrow Pg$  and $\alpha(\sup_X)$ and $\sup_Y(P \alpha)$ are again pre-composition and post-compositions, respectively, of maps with homotopies. Such a homotopy can be represented as a proof that the two pasting diagrams
\[
\xymatrix@C=1.5cm{
PX \ar@/^1pc/[r]^{Pg}   \ar[d]_{\sup_X}   \ar@/_1pc/[r]_{Pf} \ar@{}[r]|{P\alpha}
& PY \ar[d]^{\sup_Y}  \\
X  \ar@/_1pc/[r]_f  \ar@{}[r]^{\bar{f}} & Y }
\qquad
\xymatrix{
PX \ar@/^1pc/[r]^{Pg}   \ar[d]_{\sup_X} \ar@{}[r]_(.52){\bar{g}}  & PY \ar[d]^{\sup_Y}  \\
X \ar@/^1pc/[r]^g  \ar@/_1pc/[r]_f  \ar@{}[r]|{h} & Y }
\]
give the same path. Accordingly, the type of homotopies of $P$-algebra morphisms is defined by
\[
\Ho \big( (f,\bar{f}), (g, \bar{g})  \big)
 \defeq  
\sum_{\alpha :  f \sim g} \, \Id\big( \bar{f} \cdot \sup_Y(P \alpha),\, (\alpha(\sup_X))\cdot \bar{g} \big) \, .
\]




\begin{lemma}\label{IdEqHo}
Given $P$-algebras $X, Y$ and $P$-algebra morphisms $(f, \bar{f}) \, , (g, \bar{g}) \co X \to Y$,  
there is an equivalence of types
\[
\Id\big((f, \bar{f}), (g, \bar{g})\big) \simeq \Ho\big((f, \bar{f}), (g, \bar{g})\big).
\]
\end{lemma}

\begin{proof}
This follows from a more general statement to be proved in Proposition~\ref{lem:fibhomeqid} below.
\end{proof}


We now introduce the fibered versions of the notions of a $P$-algebra, $P$-algebra morphism, and $P$-algebra homotopy.

\begin{definition} \label{def:fibalg}
Let $X \in \Palg$. A \emph{fibered $P$-algebra} over $X$ is a dependent type $E \co X \to \U$
equipped with a function 
\[
\textstyle
e \in \prod_{x \in A} \prod_{u \co B(x) \to X}  \prod_{y \in B(x)}  E(u y)  \to E(\sup_X(x,u))
 \] 
\end{definition}


As we will see below, a fibered $P$-algebra amounts essentially to a dependent type such that its associated total
type $(\Sigma x : X) E(x)$ carries the structure of a $P$-algebra for which the projection $\pi_1 \co (\Sigma x : X) E(x)
\to X$ is a $P$-algebra morphism.  Accordingly, for a $P$-algebra $X$, we then define the the type of \emph{fibered $P$-algebras} over $X$ as follows:
\[
\Palg/X \defeq \sum_{E : X \to \U} \prod_{a \in A} \prod_{t \co B(a) \to X} 
 \prod_{b \in B(a)}  E(t b)  \to E(\sup_X(a,t))
 \]
This terminology and notation used in the definition is justified by the following lemma. 

\begin{lemma}\label{lem:fibalg}
Given a fibered $P$-algebra $E$ over $X$, the type $E' =  \sum_{x \in  X} E(x)$ can be equipped with the structure of a $P$-algebra in such a way that  the projection function $\pi_1 : E'\to X$ becomes a $P$-algebra morphism:
\[
\xymatrix{
P(E') \ar[r]^{P\pi_1} \ar[d]_-{\sup_{E'}} \ar@{}[rd]|{p} & PX \ar[d]^{\sup_X} \\ 
E'  \ar[r]_-{\pi_1} & X \, .}
 \]
\end{lemma}

\begin{proof} This follows by an application of the distributivity of sums and products (\ie what is sometimes
referred to as the type-theoretic axiom of choice). 
\end{proof}

\begin{definition} \label{def:fibalgsection} Let $E = (E, e)$ be a fibered $P$-algebra over a $P$-algebra $X$.  
A \emph{$P$-algebra section} of $E$ is a pair $(s, \bar{s})$, where $s \in \prod_{x \in X} E(x)$ and 
\[ 
\bar{s} \in \prod_{a \in A} \prod_{t \co B(a) \to X} \Id \big( s(\sup_X(a,t)), e(a, t, s \circ t) \big)
\]
\end{definition} 

Note that the definition of a $P$-algebra section describes exactly the data in the conclusion of the elimination rule and the propositional computation rule for an inductive $P$-algebra in the sense of Definition~\ref{def:Wind}. According to the above definition, we define the type of $P$-algebra sections of $X$ by
\[ 
\PalgSec(X,E)  \defeq \sum_{ s  \in \prod_{x \in X} E(x)}\prod_{a \in A} \prod_{t : B(a) \to X} 
\Id(   s(\sup_X(a,t)) ,  e(a,t,s  \circ t) ) \, .
\]
We will usually leave out all but the last argument of an element of $\PalgSec(X,E)$. 



\begin{lemma}\label{lem:fibalghom}
Given a fibered $P$-algebra $(E, e)$ over $X$ and an algebra section $(s, \bar{s})$, there is a $P$-algebra 
morphism $s' : X \to E'$, where the type $E' = \sum_{x \in X} E(x)$ is equipped with its canonical 
$P$-algebra structure. 
\[
\xymatrix@C=2cm@R=1.5cm{
P(E')  \ar[d]_-{\sup_{E'}}   \ar[r]_{P(\pi_1)}   & P(X)  \ar[d]^-{\sup_X}   \ar@/_1.4pc/[l]_{Ps}  \\ 
E'  \ar[r]^{\pi_1}    & X \ar@/^1.4pc/[l]^{s} }
 \]
\end{lemma}

\begin{proof} TO BE ADDED 
\end{proof}



We require an analysis of the identities of sections in terms of their homotopies.

\begin{definition} \label{def:W2cellsection} Let $E$ be a fibered $P$algebra over $X$, and let $f = (f, \bar{f})$ and $g = (g, \bar{g})$ be two $P$-algebra sections of $E$.  A \emph{$P$-algebra homotopy} 
\[
(\alpha , \bar{\alpha}) \co (f, \bar{f})  \rightarrow (g, \bar{g})
\] 
is a pair consisting of a homotopy~$\alpha \co f \sim g$ and 
\[
\bar{\alpha} \in 
\Id\big( \bar{f}(a,t)  \ct e\big(a,t, \ext (\alpha \circ t) \big),\ 
\alpha(\sup_X(a,t)) \ct \bar{g}(a,t) \big) \, . 
\]
\end{definition} 

Accordingly, we define the type of homotopies of sections as follows:
\begin{multline*}
\HoSec( (f, \bar{f}) ,\, (g, \bar{g}) )  \defeq \\ 
\sum_{\alpha \co f \sim g} \prod_{a \in A} \prod_{t : B(a) \to X} 
\Id\big( \bar{f}(a,t)  \ct e\big(a,t, \ext (\alpha \circ t) \big),\ 
\alpha(\sup_X(a,t)) \ct \bar{g}(a,t) \big) \, .
\end{multline*}
Observe that the notion of a $P$-algebra homotopy corresponds to the $(\beta, \eta)$-compatibility condition of 
Lemma~\ref{lem:Wetaind}.  The choice of terminology is justified by the following.

\begin{lemma}\label{lem:fibalghom}
Given a fibered $P$-algebra $(E, e)$ over $X$, two $P$-algebra sections $(f, \bar{f})$ and $(g, \bar{g})$, and a 
$P$-algebra homotopy $(\alpha, \bar{\alpha}) : (f, \bar{f}) \sim (g, \bar{g})$, there is a $P$-algebra homotopy between the corresponding $P$-algebra morphisms $f, g : X \to E'$ 
\[
\xymatrix{
 E' \ar@{}[d]|{\alpha} \\ 
X \ar@/^1.2pc/[u]^{f}  \ar@/_1.2pc/[u]_{g}
}
 \]
\end{lemma}




\begin{lemma}\label{lem:fibhomeqid} Let $E = (E, e)$ be a fibered algebra over a $P$-algebra $X$.
For every pair of sections $(f, \bar{f})$ and $(g, \bar{g})$,  there is an equivalence of types
\[
\HoSec\big( (f, \bar{f}) ,\, (g, \bar{g}) \big) 
\simeq 
\Id \big( (f, \bar{f}) ,\, (g, \bar{g}) \big) \, .
\]
\end{lemma}

\begin{proof}
Let algebras $(C,c) : \Palg_{\U_j}(A,B)$, $(E,e) : \FibPalg_{\U_k}(A,B) \; (C,c)$ and homomorphisms $(f,\gamma), (g,\delta) : \PalgSec \; (C,c) \; (E,e)$ be given. We have
\begin{alignat*}{4}
& (f,\gamma) = (g,\delta) & \simeq \\
& \sm{\alpha : f = g} \Big(\delta = \trans_{\big(h \mapsto \prd{a}\prd{t} h(c(a,t)) = e(a,t,\lam{b} h(t\;b))\big)}(\alpha) \; \gamma\Big) & \simeq \\
& \sm{\alpha : f = g} \Big(\delta = \lam{a} \lam{t} \happly(\alpha,c(a,t))^{-1} \ct \gamma(a,t) \ct \app_{e(a,t)}(\funext (\lam{b}\happly(\alpha,t \; b))) \Big) & \;\;\; \simeq \\
& \sm{\alpha : f \sim g} \Big(\delta = \lam{a} \lam{t} \; \alpha(c(a,t))^{-1} \ct \gamma(a,t) \ct \app_{e(a,t)}(\funext (\lam{b}\; \alpha(t \; b))) \Big) & \simeq \\
& \sm{\alpha : f \sim g} \prd{a}\prd{t}\Big(\delta(a,t) = \alpha(c(a,t))^{-1} \ct \gamma(a,t) \ct \app_{e(a,t)}(\funext (\lam{b}\; \alpha(t \; b))) \Big) & \simeq \\ 
& \sm{\alpha : f \sim g} \prd{a}\prd{t}\Big(\alpha(c(a,t)) = \gamma(a,t) \ct \app_{e(a,t)}(\funext (\lam{b}\; \alpha(t \; b))) \ct \delta(a,t)^{-1} \Big) & \equiv \\ 
& \FibAlgHot \; (f,\gamma) \; (g,\delta)
\end{alignat*}  \qedhere
\end{proof}


 

\section{Homotopy-initial $P$-algebras}

Given a $P$-algebra $X$ with structure map $\sup_X \co P(X)\to X$, an equivalence of types $f : X \to Y$ makes $Y$ into a $P$-algebra with structure map $s_Y : f \circ \sup_X \circ P(f^{-1})$,
  \[
\xymatrix{
P(X) \ar[d]_{\sup_X} \ar[r]_{P(f)} & \ar@/_1pc/[l]_{P(f^{-1})} P(Y)  \ar[d]^{\sup_Y}  \\
 X  \ar[r]_{f} & Y
 }
 \]
 where $f^{-1} : Y \to X$ is the quasi-inverse of $f : X \to Y$. In particular,  given an equivalence  $f : W \to Y$, the induced $P$-algebra structure $\sup_Y :P(Y)\to Y$ just defined then means that $Y$ also satisfies the $W$-introduction rule.  We shall see that $Y$ satisfies the other rules as well, but with weakened computation rule.




\begin{definition}\label{def:Wind}
We say that a $P$-algebra $X$  is \emph{inductive} if every fibered $P$-algebra
over it has a $P$-algebra section, \ie the type
\[ 
\isind(X) \defeq \prod_{E \in \FibPalg(X)}  \PalgSec(X,E) 
\]  
is inhabited.
\end{definition}

\begin{proposition} Let $X = (X, \sup_X)$ be a $P$-algebra. Then $X$ is inductive if and only if it satisfies the following rules:
\begin{itemize} 
\item elimination rule, \smallskip
\begin{mathpar}
\inferrule{  
x \in X \vdash E(x) \in \U \\ 
\textstyle
a \in A \, , t  \in B(a) \to X,\, s \in \prod_{b \in B(a)}  E(t b) \vdash e(x,u,v) \in E(\sup_X(a,t))}
{ x \in X \vdash \ind(x,e) \in E(x)}
\end{mathpar}

\item propositional computation rule, \smallskip
\begin{mathpar}
\inferrule{
x \in X \vdash E(x) \in \U \\ 
\textstyle
a \in A ,\, t \in  B(a) \to X ,\, e \in \prod_{b \in B(a)}  E(tb) \vdash s(a,t,u) \in E(\sup_X(a,t))}
{a \in A,\, t \in B(a) \to X \vdash \beta(a,t,s) \in \Id \big( \ind(\sup_X(a,t),s),  e(a,t, (\lambda b) \ind(t b,s)) \big)}
\end{mathpar}
\end{itemize}
\end{proposition}

\medskip

We begin by showing that being implies the essential uniqueness of $P$-sections of fibered $P$-types. 


\begin{lemma} \label{lem:Wetaind}
Let $X = (X, \sup_X)$ be a $P$-algebra. If $X$ is inductive, then it satisfies the following further rules:
\begin{itemize}
\item propositional $\eta$-rule\smallskip
\begin{mathpar}
\inferrule{
 x \in X \vdash E(x) \in \U   \\ 
 \textstyle a \in A,\,    t \in B(a) \to X,\, e \in \prod_{b \in B(a)} E(tb) \vdash s_E(a,t,e) \in E(\sup_X(a,t))  \\  
  x \in X \vdash f(x) \in E(x) \\ \\
 a \in A \, ,  t \in B(a) \to X \vdash \bar{f}(a,t) \in \Id  \big(  f(\sup_X(a,t)) ,  s_E\big(a,t, f \circ t ) \big) }
{x \in X \vdash \eta(x) \in \Id( f(x),  \ind(x,s))}
\end{mathpar}
\item coherence rule\smallskip
\begin{mathpar}
\inferrule{
x \in X \vdash E(x) \in \U   \\ 
\textstyle a \in A,\,    t \in B(a) \to X,\, e \in \prod_{b \in B(a)} E(tb) \vdash s_E(a,t,e) \in E(\sup_X(a,t))  \\  
 x \in X \vdash f(x) \in E(x) \\ \\
a \in A \, ,  t \in B(a) \to X \vdash \bar{f}(a,t) \in \Id  \big(  f(\sup_X(a,t)) ,  s_E\big(a,t, f \circ t ) \big) }
{
a \in A, t \in B(a) \to X \vdash \gamma(a,t) \in
\Id\big( \eta(\sup_X(a,t))\ct \beta(a,t), 
\bar{f}(a,t)\cdot s_E(a,t,\int(\eta\circ t)) \big)
}
\end{mathpar}
\end{itemize}
\end{lemma}


\begin{proof}
We use the $\W$-elimination rule with the type family $z \mapsto f(z) =_{E(z)} \ind(z,e)$. Thus we need to show that for any $x,u$ we have a proof of $f(s_C(x,u)) = \ind(s_C(x,u),e)$, under the induction hypothesis $h : \prd{y:B(x)} f(u(y)) = \ind((u(y),e)$. We can construct this path explicitly as follows:
\begin{align*}
f(s_C(x,u)) &= e\big(x,u,\lambda y.f(u(y))\big) \by{p(x,u)}\\
	&= e\big(x,u,\lambda y.\ind(u(y),e))\big) \by{e(x,u,\int(h))}\\
	&= \ind(s_C(x,u),e) \by{\beta(x,u)^{-1}}.
\end{align*}
Call the resulting element $\eta(z) \defeq \ind(z,q)$, for $q(x,u,h) \defeq p(x,u)\cdot e(x,u,\int(h))\cdot\beta(x,u)^{-1}$.
The propositional computation rule for this case then provides:
\begin{align*}
\beta'(x,u,q) :  \eta(s_C(x,u)) &\peq q\big(x,u,\lambda{y}.\eta(u(y))\big)\\
	&\deq p(x,u)\cdot e(x,u,\int(\lambda y.\eta(u(y))))\cdot\beta(x,u)^{-1}.
\end{align*}
Whence we get
\[
\gamma (x,u) :  \eta(s_C(x,u)) \cdot \beta(x,u)\,\peq\,
 	p(x,u)\cdot e(x,u,\int(\eta\circ u))\, ,
	\]
as required.
\end{proof}


\medskip


We now define the notion of a homotopy-initial $P$-algebra.

\begin{definition}\label{def:AlgInit}
Let $X = (X, \sup_X)$ be a $P$-algebra. We say that $X$ is  \emph{homotopy-initial}  if for any $P$-algebra 
$Y = (Y, \sup_Y)$, the type $\Palg(X,Y)$ of $P$-algebra morphisms from $X$ to $Y$
is contractible, \ie the following type is inhabilited
\[
 \prod_{Y \in \Palg}  \iscontr \big( \Palg(X,Y) \big)  \, .
\]  
\end{definition}

We stress again that homotopy-initiality is a purely type-theoretic notion. 
We have the following type-theoretic analogue of Lambek's lemma.


\begin{lemma}\label{lem:IntLambek} Let $X = (X, \sup_X)$ be a $P$-algebra. 
If $X$ is homotopy-initial, then the structure map $\sup_X \co PX \to X$ is an equivalence.
\end{lemma}


\begin{proof}
By abuse of notation we refer to both the curried and uncurried versions of the structure map by $c$. Since $(C,c)$ is homotopy-initial on $\U_j$, it satisfies the recursion principle on $\U_j$. We use it with the algebra \[\Big(\sm{x:A} B(x) \to C; a,s \mapsto \big(a,\lam{b:B(a)} c(s\;b)\big)\Big)\]
We note that the carrier type belongs to $\U_j$ as $i \leq j$. This gives us a homomorphism $(u,\theta)$ where $u : C \to \big(\sm{x:A} B(x) \to C\big)$ and $\theta : \prd{a}\prd{t} u(c(a,t)) = \big(a,\lam{b:B(a)} c(u(t\;b))\big)$.  We can now form two homomorphisms
\[\big(c \comp u; a,t \mapsto \app_c(\theta(a,t))\big), \big(\idfun{C}; a,t \mapsto \refl_{c(a,t)}\big) : \Palg \; (C,c) \; (C,c)\]
Since $(C,c)$ is initial on $\U_j$, it satisfies the recursion uniqueness principle on $\U_j$, thus the above homomorphisms are equal. Thus, we have $c \comp u = \idfun{C}$ and in particular there is a homotopy $\epsilon : c \comp u \sim \idfun{C}$. For any $a,t$, the path $\theta(a,t) \ct \app_{(a,-)}(\funext(\lam{b:B(a)} \epsilon(t\;b)))$ gives us $u(c(a,t)) = (a,t)$. Thus we have a homotopy $\eta : u \comp c \sim \idfun{\sm{x:A} B(x) \to C}$.
\end{proof}







\begin{proposition} \label{thm:recursiveW}
A $P$-algebra $X = (X, \sup_X)$  is  homotopy-initial if and only if it satisfies the following rules:
\begin{itemize}
\item recursion rule, \smallskip
\begin{mathpar}
\inferrule{
%A : \type \\  x:A \vdash B(x) : \type \\ 
% m : \W  \\  
Y : \type \\ 
a \in A \, ,  t : B(a) \to Y \vdash \sup_Y(a,t) \in Y }
{ x \in X \vdash \rec(x,\sup_Y) \in Y}
\end{mathpar}
\item simple propositional computation rule, \smallskip
\begin{mathpar}
\inferrule{
Y : \type \\ 
a \in A,\, t \in B(a) \to Y  \vdash \sup_Y(a,t) \in Y }
{a \in A,\, t \in B(a) \to Y \vdash
 \beta(a,t,\sup_Y) \in \Id \big( \rec(\sup_X(a,t),\sup_Y) \, ,  \sup_Y\big(a, (\lambda{b}) \rec(t b, \sup_Y)\big) \big)}
\end{mathpar}
\item simple propositional $\eta$-rule, \smallskip
\begin{mathpar}
\inferrule{
Y :\type \\ x :X  \vdash f(x) \in Y \\ 
a \in A,\, t : B(a) \to Y \vdash \sup_Y(a,t) \in Y \\ 
a \in A, t \in B(a) \to Y \vdash \bar{f}(a,t) : f(\sup_X(a,t)) \Rightarrow \sup_Y\big(a , t \circ f \big)}
{x  \in A \vdash \eta(x) :  f(x) = \rec(x,\sup_Y)}
\end{mathpar}
\item simple propositional coherence rule, \smallskip
\begin{mathpar}
\inferrule{
Y :\type   \\ x \in X \vdash f(x) \in Y \\ 
a \in A,\, t \in B(a) \to Y \vdash \sup_Y(a,t)  \in Y \\ 
%z:C \vdash g(z) : E(z) \\ 
a \in A, t \in B(a) \to Y \vdash \bar{f}(a,t) : f(\sup_X(a,t)) = \sup_Y(a, f \circ t )
}
%x:A, p: B(x) \to C \vdash \delta(x,p) : g(\wsup(x,p)) = e(x,p,\lam{b:B(x)} g(p \;b))}
{a \in A, t \in B(a) \to X \vdash 
\gamma(a,t) : \eta(\wsup(a,t))\ct \beta(a,t) = 
\bar{f}(a,t) \ct \sup_Y(a,\int(\eta\circ t))
}
\end{mathpar}
\end{itemize}
\end{proposition}




\begin{proof} The rules can be read as follows: the recursion rule says that, given any type $Y$ together with the function $\sup_Y : PY \to Y$ --- i.e.\ any $P$-algebra --- there is a map $\rec : X\to Y$.  The simple propositional computation rule says that this map $\rec$ is a $P$-algebra morphism.  The simple propositional $\eta$-rule says that if $f : X \to Y$ is a $P$-algebra morphism, then there is a homotopy $\eta \co f \sim \rec$.  And the simple propositional $(\beta, \eta)$-compatibility rule says that $\eta$ is in fact a $P$-algebra homotopy.
\end{proof}



We can now state and prove our main result. 

\begin{theorem}\label{thm:WMain} A $P$-algebra is inductive if and only if
it is homotopy-initial, \ie the type
\[ 
\prod_{X \in \Palg} \big( \isind(X) \leftrightarrow \ishinit(X) \big)
\]
is inhabited. 
\end{theorem}




\begin{proof}
To prove that if a $P$-algebra is inductive then it is homotopy-initial.
 The recursion and propositional $\beta$-rules are special cases of the elimination and propositional computation rules that are part of the definition of an inductive $P$-algebra. The propositional $\eta$-rule and the
propositional $(\beta, \eta)$-computatibility rules are special cases of the rules in Lemma~\ref{lem:Wetaind}.   We now  show that if $X$ is homotopy-initial then it is inductive. [USE LEMMAS \ref{lem:fibalg} and \ref{lem:fibalghom}.]
ADAPT THE PROOF OF THEOREM~\ref{thm:bipointedmain}.
\end{proof}

\begin{proposition} Let $X = (X, \sup_X)$ be a $P$-algebra. 
\begin{enumerate}[(i)]
\item The type $\isind(X)$ is a mere proposition.
\item The type $\ishinit(X)$ is a mere proposition.
\item There is an equivalence $\isind(X) \simeq \ishinit(X)$.
\end{enumerate}
\end{proposition}

\begin{proof}
The type $\ishinit(X)$ is a mere proposition since $\iscontr(A)$ is a mere proposition for any type $A$ and a family of mere propositions is again a mere proposition. To show that $\isind(X)$ is a mere proposition, we note that to prove that a type $X$ is a mere proposition, it suffices to do so under the assumption that $X$ is inhabited. Assume therefore that $\isind(X)$ is inhabited. Since a family of mere propositions is again a mere proposition, it suffices to show that $\PalgSec(X,Y)$ is a mere proposition for any $Y$. Fix sections $\mu, \nu : \PalgSec(X,Y)$. To show $\mu = \nu$, it suffices to exhibit a $P$-homotopy between $\mu$ and $\nu$. But since a $P$-homotopy is nothing more than a section of an appropriate fibered $P$-algebra, we can obtain it by using the fact that $\isind(X)$ is inhabited. Part (iii) follows
immediately from part (i) and part (ii) via Theorem~\ref{thm:WMain}.
\end{proof}

For the next proposition, we work in the type theory $\Hint + \W$, obtained by adding to $\Hint$ the rules for $W$-types.
We consider again $A \in \U$ and $B \in A \to \U$ and let $W \defeq \WW_{x \in A} B(x)$.

\begin{corollary}[$\Hint + \W$]
\label{lem:WInitInt} Let $X = (X, \sup_X)$ be a $P$-algebra. The following conditions are
equivalent:
\begin{enumerate}[(i)]
\item $X$ is inductive,
\item $X$ is homotopy initial,
\item $X$ is equivalent to $W$.
\end{enumerate}
In particular, the type $W$ is a homotopy-initial $P$-algebra.
\end{corollary}


Corollary~\ref{lem:WInitInt} provides the analogue in our setting of the characterization of W-types as a strict initial algebra in extensional type theory. It makes precise the informal idea that, in intensional type theory, W-types are a kind of homotopy or weak $\infty$-initial algebra in the $\infty$-category of types, functions, paths, higher paths, \ldots.  

\begin{lemma}[$\Hint + \W$]\label{lem:suppath}
For all $a_1,a_2 \in A$, $t_1 \in B(a_1) \to W$, $t_2 \in B(a_2) \to W$, there is an equivalence of types
\[ 
\Id ( \wsup(a_1,t_1),  \wsup(a_2,t_2)  ) \simeq  \Id \big( (a_1,t_1), (a_2,t_2) \big) \, . 
\]
\end{lemma}

\begin{proof}
By Lemma~\ref{lem:IntLambek} and Corollary~\ref{lem:WInitInt}, the structure map $\wsup \co PW \to W$ is an equivalence.
\end{proof}

We also remark that $W$-types with propositional computation rules still preserve homotopy levels, in the following sense.

\begin{theorem}[$\Hint + \W$]
If $A$ is an $(n+1)$-type, then so is $\WW_{x \in A} B(x)$.
\end{theorem}


\begin{proof}
We need to show that for any $w, w' : \W$ we have $\isntype{n}(w = w')$. By induction on $w$, it suffices to show that for any $a,t$ we have $(Pi w:\W) \isntype{n}(\wsup(a,t) = w)$ under the induction hypothesis $h : (\Pi b:B(a)) (\Pi w:\W) \isntype{n}(t(b) = w)$.  By another induction, this time on $w'$, it suffices to show that for any $a',t'$ we have
$\isntype{n}\big(\wsup(a,t) = \wsup(a',t')\big)$ under the hypothesis $(\Pi b:B(a')) \isntype{n}\big(\wsup(a,t) = t'(b)\big)$, which however is not necessary. Now we have
\begin{align*} 
\wsup(a,t) = \wsup(a',t') 
& \simeq (a,t) = (a',t') \\
& \simeq (\Sigma p : a = a') \big(t = \trans_{x \mapsto B(x) \to \W}(p) \; t'\big) \\
& \simeq  (\Sigma p : a = a')  \big(t = \lam{b:B(a)} t'(\trans_B(p) \; b)\big) \\
& \simeq (\Sigma p : a = a') (\Pi b:B(a)) \big(t(b) = t'(\trans_B(p) \; b)\big) \, , 
\end{align*}
where the first equality follows by Corollary.~\ref{lem:suppath}. Since $A$ is an $(n+1)$-type by assumption, we have $\isntype{n}(a=a')$. For any $p,b$ we have $\isntype{n}\big(t(b) = t'(\trans_B(p) \; b)\big)$ by the hypothesis~$h\big(b,t'(\trans_B(p) \; b)\big)$. Since a family of $n$-types is an $n$-type and a dependent sum of a family of $n$-types over an $n$-type is again an $n$-type, the last type in the above chain of equalities is an $n$-type. 
\end{proof}

We note that there is no restriction on the homotopy level of the fibers of $B$ since they only appear contravariantly. Furthermore, we note that the lemma is no longer true if $n+1$ is replaced by $n$, as the following example
illustrates: if $A \defeq \one$ and $B(x) \defeq \one$, then $(W x:A) B(x) \simeq \zero$, which is not contractible. 

\medskip

We conclude this section with some applications of the Univalence Axiom. The first is that, just as for bipointed 
types, a form of univalence holds also for $P$-algebras, as the next theorem makes precise. 


\begin{theorem}[$\Hint + \UA$] \label{thm:Punivalence}
Let $X$ and $Y$ be $P$-algebras. The canonical function
\[ 
\ext : \Id \big(X,Y\big) \to  \mathsf{PEquiv}(X,Y) \, .
\]
is an equivalence.
\end{theorem}

\begin{proof} 
Let $ (C,c), (D,d)$ be $P$-algebras. By the characterization of paths in $\Sigma$-types, the path space $(C,c) = (D,d)$ can be expressed as the type
\[(\Sigma p : C = D) \big( c = p^{!}(d) \big)\]
By path induction on $p$ and the characterization of paths in $\Pi$-types, this type is equivalent to
\[  \big(\Sigma p : C = D\big) (\Pi a) (\Pi t) \Big(\fst(\ext_1(p)) \; c(a,t)\Big) = d\Big(a, \fst(\ext_1(p)) \comp t\Big) \]
where $\ext_1 \co \Id(C,D) \to (C \simeq D)$ is the canonical equivalence. Since it is an equivalence, the above type is equivalent to
\[(\Sigma e : C \simeq D) (\Pi a) (\Pi t) \Big(\fst(e) \; c(a,t)\Big) = d\Big(a, \fst(e) \comp t\Big) \]
After rearranging we get
\[
 \big(\Sigma f \co \Palg \; (C,c) \; (D,d)\big) \; \isequiv(\fst(f))
\]
which by Lemma~\ref{WAlgSpace} is equivalent to $\mathsf{PEquiv}\; (C,c) \; (D,c)$ as desired. Finally, it is not hard to see that the composition of the above equivalences yields the canonical function $\ext$ (up to a homotopy).
\end{proof} 

The following corollary, still obtained under the assumption of the Univalence Axiom, shows that
homotopy-initial algebras are unique up to propositional equality. 

\begin{corollary}[$\Hint + \UA$] \label{WHInitIso}
The path space between any two homotopy-initial $P$-algebras is contractible, i.e. the type
\[ 
\prod_{X \in \Palg} \prod_{Y \in \Palg}  \Big( \mathsf{ishinitial}(X) \times \mathsf{ishinitial}(Y)  \to 
\iscontr(\Id(X,Y)) \Big) \, .
\] 
\end{corollary}

\begin{proof}
By Theorem~\ref{thm:Punivalence} it suffices to prove $\iscontr(\mathsf{PEquiv}(X,Y))$. The type $\Palg(X,Y)$ is contractible by homotopy-initiality of $X$. Since the dependent sum of a family of mere propositions over a mere proposition is again a mere proposition, it suffices to prove $\iscontr(\mathsf{isPequiv}(f))$ for any $P$-morphism $f$. This type is a mere proposition, as remarked earlier; thus it suffices to show it is inhabited.
Since $Y$ is homotopy-initial, there exists a $P$-algebra morphism $g : Y \to X$. Again by homotopy-initiality of $X$ and 
$Y$, we have $g \comp f = 1_X$ and $f \comp g = 1_Y$, which gives us the desired $P$-algebra equivalence between 
$X$ and $Y$.
\end{proof}


\section*{Acknowledgements}

We would like to thank Vladimir Voevodsky and Michael Warren for helpful discussions
on the subject of this paper. In particular, Vladimir Voevodsky suggested a simplification of the 
proof that the rules for homotopical W-types imply h-initiality. 
 Steve Awodey gratefully acknowledges the support of the National Science Foundation, Grant DMS-1001191 and the Air Force OSR, Grant 11NL035. Nicola Gambino is grateful for the support of the Institute for Advanced Study, where
he worked on this project. This work was supported by the National Science Foundation 
under agreement No.\ DMS-0635607. Any opinions, findings and conclusions or recommendations
expressed in this material are those of the authors and do not necessarily reflect the views of
the National Science Foundation. Kristina Sojakova is grateful for the support of CyLab at Carnegie
Mellon under grants DAAD19-02-1-0389 and W911NF-09-1-0273 from the Army
Research Office.



\appendix

\section{Type-theoretic rules}


\subsection*{Rules for $\Pi$-types}

\begin{itemize}
\item Formation rule
\[
\begin{prooftree}
x \co A \vdash B(x) \co \type
\justifies
(\Pi x \co A) B(x) \co \type
\end{prooftree}
\]
\item Introduction rule
\[
\begin{prooftree}
x \co A \vdash b(x) \co B(x) 
\justifies
(\lambda x \co A)b(x) \co (\Pi x : A) B(x)
\end{prooftree}
\]
\item Elimination rule
\[
\begin{prooftree}
f \co (\Pi x : A) B(x) \quad
a \co A 
\justifies
\app(f, a) \co B(a)
\end{prooftree}
\]
\item $\beta$-rule
\[
\begin{prooftree}
x \co A \vdash b(x) \co B(x) 
\justifies
\app( (\lambda x : A) b(x), a) \equiv b(a) \co B(a)
\end{prooftree}
\]
\item $\eta$-rule
\[
\begin{prooftree}
f \co (\Pi x :A) B(x) 
\justifies
f \equiv (\lambda x : A) \app(f, x) \co (\Pi x \co A) B(x)
\end{prooftree}
\]
 \end{itemize} \
 
 
 \subsection*{Rules for $\Sigma$-types}
 
 \begin{itemize}
\item Formation rule
\[
\begin{prooftree}
x \co A \vdash B(x) \co \type
\justifies
(\Sigma x \co A) B(x) \co \type
\end{prooftree}
\]
\item Introduction rule
\[
\begin{prooftree}
a \co A \qquad 
b(a) \co B(a) 
\justifies
\pair(a,b) \co (\Sigma x : A) B(x)
\end{prooftree}
\]
\item $\Sigma$-elimination rule.
\[
\begin{prooftree}
\begin{array}{l} 
u : (\Sigma x : A) B(x) \vdash E(u) :  \type \\
 x :  A, y \co B(x) \vdash  e(x,y) :  E(\pair(x,y))  
 \end{array}
\justifies
u :  (\Sigma x :A)B(x) \vdash  \mysplit(u,e) :  E(u)
\end{prooftree}
\]
\item $\Sigma$-computation rule.
\[
\begin{prooftree}
\begin{array}{l} 
u : (\Sigma x : A) B(x) \vdash E(u) :  \type \\
 x :  A, y \co B(x) \vdash  e(x,y) :  E(\pair(x,y))  
 \end{array}
 \justifies
x :  A, y \co B(x) \vdash \mysplit(\pair(x,y),e) \equiv e(x,y) :  E(\pair(x,y)) \, .
\end{prooftree}
\]
\end{itemize} 



\subsection*{Rules for $\Id$-types}

\begin{itemize}
\item $\Id$-formation rule.
\[
\begin{prooftree}
A :  \type \quad 
a :  A  \quad
b :  A 
\justifies
 \id{A}(a,b) :  \type
 \end{prooftree}
\]
\item $\Id$-introduction rule.
\[
\begin{prooftree}
a :  A 
\justifies
 \refl(a) :  \id{A}(a,a)
 \end{prooftree} 
\]
\item $\Id$-elimination rule.
\[
\begin{prooftree}
\begin{array}{l} 
x, y :  A, u :  \id{A}(x,y) \vdash E(x,y,u) :  \type \\
 x :  A \vdash  e(x) :  E(x,x,\refl(x))  
 \end{array}
\justifies
x, y :  A, u :  \id{A}(x,y) \vdash  \idrec(x,y,u,e) :  E(x,y,u)
\end{prooftree}
\]
\item $\Id$-computation rule.
\[
\begin{prooftree}
\begin{array}{l} 
x, y :  A, u :  \id{A}(x,y) \vdash E(x,y,u) :  \type \\
 x :  A \vdash  e(x) :  E(x,x,\refl(x)) 
 \end{array}
 \justifies
x :  A \vdash \idrec(x,x,\refl(x), e) = e(x) :  E(x, x, \refl(x)) \, .
\end{prooftree}
\]
\end{itemize} 


\subsection*{Rules for $\Bool$}


\begin{itemize}
\item Formation rule. \smallskip

\[
 \Bool : \U \, .
 \]  \medskip
\item Introduction rules. \smallskip

\[
0 : \Bool \, ,  \qquad  1 : \Bool \, .
\]  
\item Elimination rule.\medskip

\[
\begin{prooftree}
x:\Bool \vdash E(x) : \U \qquad
e_0 : E(0) \qquad
e_1 : E(1) \qquad
\justifies
x \co \Bool \vdash \boolind(x, e_0, e_1) : E(x) 
\end{prooftree}
\] \bigskip
\item Computation rules. \smallskip

\begin{equation*}
\begin{prooftree}
x:\Bool \vdash E(x) : \U \qquad
e_0 : E(0) \qquad
e_1 : E(1)
\justifies
  \boolind(0, e_0, e_1)  \deq  e_0 \co E(0) \, , \\
\end{prooftree}
 \end{equation*}  
 \bigskip
 \begin{equation*}
\begin{prooftree}
x:\Bool \vdash E(x) : \U \qquad
e_0 : E(0) \qquad
e_1 : E(1)
\justifies
 \boolind(1,e_0,e_1)  \deq e_1 \co E(1) \, .
\end{prooftree}
 \end{equation*}  
\end{itemize}


\subsection*{Rules for $W$-types}

\begin{itemize}
\item $\W$-formation rule.\smallskip
\[
\begin{prooftree}
 A : \type \qquad
 x:A \vdash B(x) : \type
 \justifies
 (\W{x : A})B(x) : \type
\end{prooftree}
\]
\item $\W$-introduction rule.\smallskip
\[
\begin{prooftree}
%A : \type \qquad
%x:A \vdash B(x) : \type \qquad
a:A \qquad
t : B(a) \to \W
\justifies
\wsup(a,t): \W
\end{prooftree}
\]
\item $\W$-elimination rule.\smallskip
\begin{mathpar}
\inferrule{
%A : \type \\  x:A \vdash B(x) : \type \\ 
% m : \W  \\  
w : \W \vdash E(w) : \type \\ 
x:A,\, u : B(x) \to \W,\, v : \big(\Pi{y:B(x)}\big) E(u(y)) \vdash e(x,u,v) :E(\wsup(x,u))}
{ w : \W \vdash \ind(w,e) : E(w)}
\end{mathpar}
\item $\W$-computation rule.\smallskip
\begin{mathpar}
\inferrule{
w : \W \vdash E(w) : \type \\ 
x:A,\, u : B(x) \to \W,\, v : \big(\Pi{y:B(x)}\big) E(u(y)) \vdash e(x,u,v) :E(\wsup(x,u))}
{x:A,\, u : B(x) \to \W \vdash \\
 \ind(\wsup(x,u),e) \equiv e\big(x,u,\lambda{y}.\ind(u(y),e)\big) : E(\wsup(x,u))}
\end{mathpar}
\end{itemize}



\bibliographystyle{plain}

\bibliography{references}
                        


\end{document}